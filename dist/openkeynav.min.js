"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t["return"]||t["return"]()}finally{if(u)throw o}}}}function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)},_wrapNativeSuper(t)}function _construct(t,e,r){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t.bind.apply(t,o));return r&&_setPrototypeOf(p,r.prototype),p}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var version="0.1.8";var OpenKeyNav=function(){function OpenKeyNav(){_classCallCheck(this,OpenKeyNav);this.config={spot:{fontColor:"white",backgroundColor:"#333",insetColor:"#000",fontSize:"inherit",arrowSize_px:4},focus:{outlineColor:"#0088cc",outlineStyle:"solid"},keys:{escape:"q",click:"k",scroll:"s",move:"m",heading:"h",textBlock:"n",landmarkRegion:"d",formField:"f",mouseOver:"v",heading_1:"1",heading_2:"2",heading_3:"3",heading_4:"4",heading_5:"5",heading_6:"6"},modesConfig:{move:{config:[],selectedConfig:false,selectedMoveable:false,selectedMoveableHTML:false,selectedDropZone:false,modifier:false},click:{modifier:false,clickEventElements:new Set,eventListenersMap:new Map}},log:[],typedLabel:"",headings:{currentHeadingIndex:0,list:[]},scrollables:{currentScrollableIndex:0,list:[]},modes:{clicking:false,moving:false},debug:{screenReaderVisible:false,keyboardAccessible:true},init:function init(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};deepMerge(OpenKeyNav,options);injectStylesheet();addKeydownEventListener()}}}return _createClass(OpenKeyNav,[{key:"setupTouchEvent",value:function setupTouchEvent(){window.TouchEvent=function(_Event){function TouchEvent(type,initDict){var _this;_classCallCheck(this,TouchEvent);_this=_callSuper(this,TouchEvent,[type,initDict]);_this.touches=initDict.touches||[];_this.targetTouches=initDict.targetTouches||[];_this.changedTouches=initDict.changedTouches||[];_this.altKey=initDict.altKey||false;_this.metaKey=initDict.metaKey||false;_this.ctrlKey=initDict.ctrlKey||false;_this.shiftKey=initDict.shiftKey||false;return _this}_inherits(TouchEvent,_Event);return _createClass(TouchEvent)}(_wrapNativeSuper(Event));window.Touch=_createClass((function _class(_ref){var identifier=_ref.identifier,target=_ref.target,clientX=_ref.clientX,clientY=_ref.clientY;_classCallCheck(this,_class);this.identifier=identifier;this.target=target;this.clientX=clientX;this.clientY=clientY;this.screenX=clientX;this.screenY=clientY;this.pageX=clientX;this.pageY=clientY}))}},{key:"deepMerge",value:function deepMerge(target,source){var _this2=this;Object.keys(source).forEach((function(key){if(source[key]&&_typeof(source[key])==="object"){if(!target[key]||_typeof(target[key])!=="object"){target[key]={}}_this2.deepMerge(target[key],source[key])}else{target[key]=source[key]}}));return target}},{key:"injectStylesheet",value:function injectStylesheet(){var style=document.createElement("style");style.type="text/css";style.innerHTML=""+".openKeyNav-label {"+"font: inherit;"+"vertical-align: baseline;"+"box-sizing: border-box;"+"white-space: nowrap;"+"border: 1px solid ".concat(this.config.spot.fontColor,";")+"background-color: ".concat(this.config.spot.backgroundColor,";")+"color: ".concat(this.config.spot.fontColor,";")+"display: inline-block;"+"font-size: ".concat(this.config.spot.fontSize,";")+"outline-offset: -2px !important;"+"font-weight: inherit;"+"line-height: 1;"+"margin: 0 .1em 0 1px;"+"overflow-wrap: break-word;"+"padding: 3px;"+"text-shadow: 0 1px 0 ".concat(this.config.spot.insetColor,";")+"min-width: 1rem;"+"text-align: center;"+"position: absolute;"+"z-index: 99999999;"+"font-family: monospace;"+"}"+'.openKeyNav-label[data-openkeynav-position="left"]::after, '+'.openKeyNav-label[data-openkeynav-position="right"]::before, '+'.openKeyNav-label[data-openkeynav-position="top"]::after, '+'.openKeyNav-label[data-openkeynav-position="bottom"]::before, '+'.openKeyNav-label[data-openkeynav-position="left"]::before, '+'.openKeyNav-label[data-openkeynav-position="right"]::after, '+'.openKeyNav-label[data-openkeynav-position="top"]::before, '+'.openKeyNav-label[data-openkeynav-position="bottom"]::after {'+'content: "";'+"position: absolute;"+"}"+'.openKeyNav-label[data-openkeynav-position="left"]::after, '+'.openKeyNav-label[data-openkeynav-position="right"]::before, '+'.openKeyNav-label[data-openkeynav-position="left"]::before, '+'.openKeyNav-label[data-openkeynav-position="right"]::after {'+"top: 50%;"+"transform: translateY(-50%);"+"}"+'.openKeyNav-label[data-openkeynav-position="top"]::after, '+'.openKeyNav-label[data-openkeynav-position="bottom"]::before, '+'.openKeyNav-label[data-openkeynav-position="top"]::before, '+'.openKeyNav-label[data-openkeynav-position="bottom"]::after {'+"left: 50%;"+"transform: translateX(-50%);"+"}"+'.openKeyNav-label[data-openkeynav-position="left"]::before {'+"border-left: ".concat(this.config.spot.arrowSize_px+1,"px solid #fff;")+"right: -".concat(this.config.spot.arrowSize_px+1,"px;")+"border-top: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"border-bottom: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="left"]::after {'+"border-left: ".concat(this.config.spot.arrowSize_px,"px solid ").concat(this.config.spot.backgroundColor,";")+"right: -".concat(this.config.spot.arrowSize_px,"px;")+"border-top: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"border-bottom: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="right"]::before {'+"border-right: ".concat(this.config.spot.arrowSize_px+1,"px solid #fff;")+"left: -".concat(this.config.spot.arrowSize_px+1,"px;")+"border-top: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"border-bottom: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="right"]::after {'+"border-right: ".concat(this.config.spot.arrowSize_px,"px solid ").concat(this.config.spot.backgroundColor,";")+"left: -".concat(this.config.spot.arrowSize_px,"px;")+"border-top: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"border-bottom: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="top"]{'+"padding-bottom: 0;"+"}"+'.openKeyNav-label[data-openkeynav-position="top"]::before {'+"border-top: ".concat(this.config.spot.arrowSize_px+1,"px solid #fff;")+"bottom: -".concat(this.config.spot.arrowSize_px+1,"px;")+"border-left: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"border-right: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="top"]::after {'+"border-top: ".concat(this.config.spot.arrowSize_px,"px solid ").concat(this.config.spot.backgroundColor,";")+"bottom: -".concat(this.config.spot.arrowSize_px,"px;")+"border-left: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"border-right: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="bottom"]{'+"padding-top: 0;"+"}"+'.openKeyNav-label[data-openkeynav-position="bottom"]::before {'+"border-bottom: ".concat(this.config.spot.arrowSize_px+1,"px solid #fff;")+"top: -".concat(this.config.spot.arrowSize_px+1,"px;")+"border-left: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"border-right: ".concat(this.config.spot.arrowSize_px+1,"px solid transparent;")+"}"+'.openKeyNav-label[data-openkeynav-position="bottom"]::after {'+"border-bottom: ".concat(this.config.spot.arrowSize_px,"px solid ").concat(this.config.spot.backgroundColor,";")+"top: -".concat(this.config.spot.arrowSize_px,"px;")+"border-left: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"border-right: ".concat(this.config.spot.arrowSize_px,"px solid transparent;")+"}"+".openKeyNav-label-selected{"+"display : grid;"+"align-content : center;"+"color : ".concat(this.config.spot.fontColor,";")+"background : ".concat(this.config.spot.backgroundColor,";")+"outline: none;"+"}"+"[data-openkeynav-label]:not(.openKeyNav-label):not(button){"+"box-shadow:  inset 0 0 0 .5px #000,\n                        0 0 0 .75px #000,\n                        0 0 0 1.5px rgba(255,255,255,1);"+"outline:none !important;"+"border-color: #000;"+"border-radius: 3px;"+"}"+"button[data-openkeynav-label]{"+"outline:2px solid #000 !important;"+"}"+".openKeyNav-inaccessible:not(.openKeyNav-label):not(button){"+"box-shadow:  inset 0 0 0 .5px #f00,\n                        0 0 0 1px #f00,\n                        0 0 0 1.5px rgba(255,255,255,1);"+"outline:none !important;"+"border-color: #f00;"+"border-radius: 3px;"+"}"+"button.openKeyNav-inaccessible{"+"outline:2px solid #f00 !important;"+"}"+".openKeyNav-inaccessible.openKeyNav-label{"+"box-shadow:  inset 0 0 0 .5px #f00,\n                        0 0 0 1px #f00,\n                        0 0 0 1.5px rgba(255,255,255,1);"+"border-color: #f00;"+"border-radius: 3px;"+"}"+".openKeyNav-noCursor *{"+"cursor: none !important;"+"}"+"*:focus {"+"outline: 2px ".concat(this.config.focus.outlineStyle," ").concat(this.config.focus.outlineColor," !important;")+"outline-offset: -2px !important;"+"}"+".openKeyNav-mouseover-tooltip{"+"position: absolute;"+"background-color: #333;"+"color: #fff;"+"padding: 5px;"+"border-radius: 5px;"+"display: none;"+"z-index: 1000;"+"font-size: 12px;"+"}"+".openKeyNav-mouseover-tooltip::before{"+'content: "Debug mode"'+"}";document.head.appendChild(style)}},{key:"isNonzeroSize",value:function isNonzeroSize(element){var rect=element.getBoundingClientRect();return rect.width>0&&rect.height>0}},{key:"isTextInputActive",value:function isTextInputActive(){var tagName=document.activeElement.tagName.toLowerCase();var editable=document.activeElement.getAttribute("contenteditable");var inputTypes=["input","textarea"];var isEditable=editable==="true"||editable==="plaintext-only"||editable==="";return inputTypes.includes(tagName)||isEditable}},{key:"updateOverlayPosition",value:function updateOverlayPosition(element,overlay){var elementsToAvoid=document.querySelectorAll("[data-openkeynav-label], .openKeyNav-label-selected");var rectAvoid=element.getBoundingClientRect();var overlayWidth=overlay.getBoundingClientRect().width;var overlayHeight=overlay.getBoundingClientRect().height;var arrowWidth=this.config.spot.arrowSize_px;function isBoundingBoxIntersecting(rectOverlay,rectAvoid){return!(rectOverlay.right<=rectAvoid.left||rectOverlay.left>=rectAvoid.right||rectOverlay.bottom<=rectAvoid.top||rectOverlay.top>=rectAvoid.bottom)}var isOverlapping=function isOverlapping(overlay,avoidEl){var rectOverlay=overlay.getBoundingClientRect();var rectAvoid=avoidEl.getBoundingClientRect();var isOverlapping_OnTop=function isOverlapping_OnTop(){var padding=0;var corners=[{x:rectOverlay.left-padding,y:rectOverlay.top-padding},{x:rectOverlay.right+padding,y:rectOverlay.top-padding},{x:rectOverlay.left-padding,y:rectOverlay.bottom+padding},{x:rectOverlay.right+padding,y:rectOverlay.bottom+padding}];overlay.style.visibility="hidden";var isOverlapping=corners.some((function(corner){if(corner.x>=0&&corner.x<=window.innerWidth&&corner.y>=0&&corner.y<=window.innerHeight){var elementAtPoint=document.elementFromPoint(corner.x,corner.y);return avoidEl===elementAtPoint||avoidEl.contains(elementAtPoint)}return false}));overlay.style.visibility="visible";return isOverlapping};return isBoundingBoxIntersecting(rectOverlay,rectAvoid)&&isOverlapping_OnTop()};function isCutOff(el){var rect=el.getBoundingClientRect();return rect.left<0||rect.right>window.innerWidth||rect.top<0||rect.bottom>window.innerHeight}function checkOverlap(overlay){return isCutOff(overlay)||Array.from(elementsToAvoid).some((function(avoidEl){if(avoidEl===overlay||avoidEl===element){return false}var rectElement=element.getBoundingClientRect();var rectAvoidEl=avoidEl.getBoundingClientRect();var isElementOnTop=isBoundingBoxIntersecting(rectElement,rectAvoidEl);if(isElementOnTop){return false}return isOverlapping(overlay,avoidEl)}))}overlay.removeAttribute("data-openkeynav-position");overlay.style.position="absolute";overlay.style.left="".concat(rectAvoid.left-(overlayWidth+arrowWidth)+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top+window.scrollY,"px");var position="left";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.right+arrowWidth-2+window.scrollX,"px");position="right";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top-(overlayHeight+arrowWidth)+window.scrollY,"px");position="top";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.bottom+arrowWidth+window.scrollY,"px");position="bottom";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.removeAttribute("data-openkeynav-position");overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top+window.scrollY,"px")}},{key:"updateOverlayPosition_bak",value:function updateOverlayPosition_bak(element,overlay){var rect=element.getBoundingClientRect();var adjustedLeft=rect.left;var adjustedTop=rect.top;var parent=element.ownerDocument.defaultView.frameElement;while(parent){var parentRect=parent.getBoundingClientRect();adjustedLeft+=parentRect.left;adjustedTop+=parentRect.top;parent=parent.ownerDocument.defaultView.frameElement}overlay.style.left="".concat(adjustedLeft+window.scrollX,"px");overlay.style.top="".concat(adjustedTop+window.scrollY,"px")}},{key:"createOverlay",value:function createOverlay(element,label){var _this3=this;function getScrollParent(element){var includeHidden=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var style=getComputedStyle(element);var excludeStaticParent=style.position==="absolute";var overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/;if(style.position==="fixed")return document.body;for(var parent=element;parent=parent.parentElement;){style=getComputedStyle(parent);if(excludeStaticParent&&style.position==="static"){continue}if(overflowRegex.test(style.overflow+style.overflowY+style.overflowX))return parent}return document.body}var overlay=document.createElement("div");overlay.textContent=label;overlay.classList.add("openKeyNav-label");overlay.setAttribute("data-openkeynav-label",label);overlay.addEventListener("click",(function(){try{inspect(element)}catch(error){console.log(element)}}));document.body.appendChild(overlay);this.updateOverlayPosition(element,overlay);var scrollParent=getScrollParent(element);if(scrollParent){scrollParent.addEventListener("scroll",(function(){return _this3.updateOverlayPosition(element,overlay)}))}if(element.classList.contains("openKeyNav-inaccessible")){overlay.classList.add("openKeyNav-inaccessible")}return overlay}},{key:"isTopLeftCornerVisible",value:function isTopLeftCornerVisible(element){var isElementInIframe=function isElementInIframe(element){return element.ownerDocument!==window.document};var doc=element.ownerDocument;var win=doc.defaultView||doc.parentWindow;var rect=element.getBoundingClientRect();var x=rect.left+1;var y=rect.top+1;if(isElementInIframe(element)){var frameElement=win.frameElement;if(frameElement){var frameRect=frameElement.getBoundingClientRect();x+=frameRect.left;y+=frameRect.top;doc=frameElement.ownerDocument;win=doc.defaultView||doc.parentWindow}}var elemAtPoint=doc.elementFromPoint(x,y);return elemAtPoint===element||element.contains(elemAtPoint)}},{key:"getScrollableElements",value:function getScrollableElements(){var _this4=this;var getComputedStyle=document.body&&document.body.currentStyle?function(elem){return elem.currentStyle}:function(elem){return document.defaultView.getComputedStyle(elem,null)};function getActualCss(elem,style){return getComputedStyle(elem)[style]}function isOverflowScrollable(overflow){return overflow==="scroll"||overflow==="auto"||overflow==="overlay"}function isXScrollable(elem){var overflowX=getActualCss(elem,"overflow-x");if(overflowX==="scroll")return true;return elem.offsetWidth<elem.scrollWidth&&(overflowX==="scroll"||overflowX==="auto"||overflowX==="overlay")}function isYScrollable(elem){var overflowY=getActualCss(elem,"overflow-y");if(overflowY==="scroll")return true;return elem.offsetHeight<elem.scrollHeight&&(overflowY==="scroll"||overflowY==="auto"||overflowY==="overlay")}function isPotentiallyScrollable(elem){var position=getActualCss(elem,"position");var display=getActualCss(elem,"display");var visibility=getActualCss(elem,"visibility");if(position==="static"&&display==="inline"&&visibility!=="hidden"){return false}return true}var hasScroller=function hasScroller(elem){if(!_this4.config.debug.screenReaderVisible){return _this4.isTopLeftCornerVisible(elem)&&isPotentiallyScrollable(elem)&&(isYScrollable(elem)||isXScrollable(elem))}return isPotentiallyScrollable(elem)&&(isYScrollable(elem)||isXScrollable(elem))};return[].filter.call(document.querySelectorAll("*"),hasScroller)}},{key:"preventScroll",value:function preventScroll(e){e.preventDefault();e.stopPropagation();return false}},{key:"clearMoveAttributes",value:function clearMoveAttributes(){document.querySelectorAll("[data-openkeynav-moveconfig]").forEach((function(el){el.removeAttribute("data-openkeynav-moveconfig");el.removeAttribute("data-openkeynav-draggable")}))}},{key:"removeOverlays",value:function removeOverlays(removeAll){var _this5=this;var resetModes=function resetModes(){for(var key in _this5.config.modes){_this5.config.modes[key]=false}_this5.config.modesConfig.move.selectedConfig=false;_this5.config.modesConfig.move.selectedMoveable=false;_this5.config.modesConfig.move.selectedMoveableHTML=false;_this5.config.modesConfig.move.selectedDropZone=false;_this5.config.modesConfig.move.modifier=false;_this5.config.modesConfig.click.modifier=false};var clearInaccessibleWarnings=function clearInaccessibleWarnings(){document.querySelectorAll(".openKeyNav-inaccessible").forEach((function(el){el.classList.remove("openKeyNav-inaccessible");if(_this5.config.modesConfig.click.eventListenersMap.has(el)){var _this5$config$modesCo=_this5.config.modesConfig.click.eventListenersMap.get(el),showTooltip=_this5$config$modesCo.showTooltip,hideTooltip=_this5$config$modesCo.hideTooltip;el.removeEventListener("mouseover",showTooltip);el.removeEventListener("mouseleave",hideTooltip);_this5.config.modesConfig.click.eventListenersMap["delete"](el)}}));document.querySelectorAll(".openKeyNav-mouseover-tooltip").forEach((function(el){return el.remove()}))};var enableScrolling=function enableScrolling(){var enableScrollingForEl=function enableScrollingForEl(el){el.removeEventListener("scroll",_this5.preventScroll,{passive:false});el.removeEventListener("wheel",_this5.preventScroll,{passive:false});el.removeEventListener("touchmove",_this5.preventScroll,{passive:false})};var enableScrollingForScrollableElements=function enableScrollingForScrollableElements(){enableScrollingForEl(window);_this5.getScrollableElements().forEach((function(el){enableScrollingForEl(el)}))};enableScrollingForScrollableElements()};var removeAllOverlays=function removeAllOverlays(){document.querySelectorAll(".openKeyNav-label").forEach((function(el){return el.remove()}))};var removeAllOverlaysExceptThis=function removeAllOverlaysExceptThis(selectedLabel,typedLabel){selectedLabel.innerHTML="&bull;";selectedLabel.classList.add("openKeyNav-label-selected");document.querySelectorAll('.openKeyNav-label:not([data-openkeynav-label="'.concat(typedLabel,'"])')).forEach((function(el){return el.remove()}))};if(this.config.modes.clicking){enableScrolling()}clearInaccessibleWarnings();if(removeAll){removeAllOverlays()}else{if(!this.config.modes.moving){removeAllOverlays()}else{var selectedLabel=document.querySelector('.openKeyNav-label[data-openkeynav-label="'.concat(this.config.typedLabel,'"]'));if(!selectedLabel){removeAllOverlays()}else{this.config.modesConfig.move.selectedLabel=selectedLabel;removeAllOverlaysExceptThis(selectedLabel,this.config.typedLabel)}}}document.querySelectorAll("[data-openkeynav-label]").forEach((function(el){el.removeAttribute("data-openkeynav-label")}));resetModes();this.config.typedLabel=""}},{key:"flagAsInaccessible",value:function flagAsInaccessible(el,reason,modality){switch(modality){case"keyboard":if(!this.config.debug.keyboardAccessible){return false}default:break}function createTooltip(el,innerHTML){var tooltip=document.createElement("div");tooltip.className="openKeyNav-mouseover-tooltip";tooltip.innerHTML=innerHTML;tooltip.style.display="none";document.body.appendChild(tooltip);function showTooltip(){var rect=el.getBoundingClientRect();tooltip.style.left="".concat(rect.left+window.scrollX,"px");tooltip.style.top="".concat(rect.bottom+window.scrollY-2,"px");tooltip.style.display="block"}function hideTooltip(){var mouseX=event.clientX;var mouseY=event.clientY;var tooltipRect=tooltip.getBoundingClientRect();var isMouseOverTooltip=mouseX>=tooltipRect.left&&mouseX<=tooltipRect.right&&mouseY>=tooltipRect.top&&mouseY<=tooltipRect.bottom;if(!isMouseOverTooltip){tooltip.style.display="none"}}el.addEventListener("mouseover",showTooltip);el.addEventListener("mouseleave",hideTooltip);tooltip.addEventListener("mouseleave",hideTooltip);this.config.modesConfig.click.eventListenersMap.set(el,{showTooltip:showTooltip,hideTooltip:hideTooltip})}el.classList.add("openKeyNav-inaccessible");el.setAttribute("data-openkeynav-inaccessible-reason",reason);return true}},{key:"addKeydownEventListener",value:function addKeydownEventListener(){var _this6=this;var beginDrag=function beginDrag(){var sourceElement=_this6.config.modesConfig.move.selectedMoveable;var rectSource=sourceElement.getBoundingClientRect();var dataTransfer=new DataTransfer;if(typeof TouchEvent==="undefined"){_this6.setupTouchEvent()}var mouseDownEvent=new MouseEvent("mousedown",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2,clientY:rectSource.top+rectSource.height/2});sourceElement.dispatchEvent(mouseDownEvent);var touchStartEvent=new TouchEvent("touchstart",{bubbles:true,cancelable:true,touches:[new Touch({identifier:Date.now(),target:sourceElement,clientX:rectSource.left+rectSource.width/2,clientY:rectSource.top+rectSource.height/2})]});sourceElement.dispatchEvent(touchStartEvent);var mouseMoveEvent=new MouseEvent("mousemove",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2+10,clientY:rectSource.top+rectSource.height/2+10});document.dispatchEvent(mouseMoveEvent);var dragStartEvent=new DragEvent("dragstart",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2+10,clientY:rectSource.top+rectSource.height/2+10,dataTransfer:dataTransfer});Object.defineProperty(dragStartEvent,"dataTransfer",{value:dataTransfer});sourceElement.dispatchEvent(dragStartEvent)};var endDrag=function endDrag(targetElement){var dataTransfer=new DataTransfer;var clientX=0;var clientY=0;var sourceElement=_this6.config.modesConfig.move.selectedMoveable;if(typeof TouchEvent==="undefined"){_this6.setupTouchEvent()}if(!sourceElement){sourceElement=document.body}if(!targetElement){targetElement=document.body}var rectTarget=targetElement.getBoundingClientRect();if(targetElement!=document){clientX=rectTarget.left+rectTarget.width/2;clientY=rectTarget.top+rectTarget.height/2}var mouseMoveEvent=new MouseEvent("mousemove",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY});var touchMoveEvent=new TouchEvent("touchmove",{bubbles:true,cancelable:true,touches:[new Touch({identifier:Date.now(),target:targetElement,clientX:clientX,clientY:clientY})]});var dragEnterEvent=new DragEvent("dragenter",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragEnterEvent,"dataTransfer",{value:dataTransfer});var dragOverEvent=new DragEvent("dragover",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragOverEvent,"dataTransfer",{value:dataTransfer});var dropEvent=new DragEvent("drop",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dropEvent,"dataTransfer",{value:dataTransfer});var dragEndEvent=new DragEvent("dragend",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragEndEvent,"dataTransfer",{value:dataTransfer});var mouseUpEvent=new MouseEvent("mouseup",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY});var touchEndEvent=new TouchEvent("touchend",{bubbles:true,cancelable:true,changedTouches:[new Touch({identifier:Date.now(),target:targetElement,clientX:clientX,clientY:clientY})]});try{document.dispatchEvent(mouseMoveEvent)}catch(error){console.log(error)}try{document.dispatchEvent(touchMoveEvent)}catch(error){console.log(error)}try{targetElement.dispatchEvent(dragEnterEvent)}catch(error){console.log(error)}try{targetElement.dispatchEvent(dragOverEvent)}catch(error){console.log(error)}try{if(targetElement!=document){targetElement.dispatchEvent(dropEvent)}}catch(error){console.log(error)}try{sourceElement.dispatchEvent(dragEndEvent)}catch(error){console.log(error)}targetElement.dispatchEvent(mouseUpEvent);targetElement.dispatchEvent(touchEndEvent)};var doEscape=function doEscape(e){var returnFalse=false;if(_this6.config.modes.clicking||_this6.config.modes.moving){e.preventDefault();e.stopPropagation();endDrag();_this6.removeOverlays();_this6.clearMoveAttributes();returnFalse=true}if(_this6.isTextInputActive()){document.activeElement.blur()}if(returnFalse){return false}else{if(document.activeElement!=document.body){document.activeElement.blur()}}};var focusOnScrollables=function focusOnScrollables(e){_this6.config.scrollables.list=_this6.getScrollableElements();if(_this6.config.scrollables.list.length==0){return}{if(e.shiftKey){_this6.config.currentScrollableIndex=_this6.config.currentScrollableIndex>0?_this6.config.currentScrollableIndex-1:_this6.config.scrollables.list.length-1}else{_this6.config.currentScrollableIndex=_this6.config.currentScrollableIndex<_this6.config.scrollables.list.length-1?_this6.config.currentScrollableIndex+1:0}}var currentScrollable=_this6.config.scrollables.list[_this6.config.currentScrollableIndex];if(!currentScrollable.getAttribute("tabindex")){currentScrollable.setAttribute("tabindex","-1")}currentScrollable.focus();currentScrollable.addEventListener("blur",(function handler(){currentScrollable.removeAttribute("tabindex");currentScrollable.removeEventListener("blur",handler)}))};var focusOnHeadings=function focusOnHeadings(headings,e){_this6.config.headings.list=Array.from(document.querySelectorAll(headings)).filter((function(el){var style=getComputedStyle(el);if(style.display==="none"||style.visibility==="hidden")return false;if(!_this6.config.debug.screenReaderVisible){if(!_this6.isTopLeftCornerVisible(el)){return false}}return true}));if(_this6.config.headings.list.length==0){return true}if(e.shiftKey){if(_this6.config.headings.currentHeadingIndex>0){_this6.config.headings.currentHeadingIndex--}else{_this6.config.headings.currentHeadingIndex=_this6.config.headings.list.length-1}}else{if(_this6.config.headings.currentHeadingIndex<_this6.config.headings.list.length-1){_this6.config.headings.currentHeadingIndex++}else{_this6.config.headings.currentHeadingIndex=0}}var nextHeading=_this6.config.headings.list[_this6.config.headings.currentHeadingIndex];if(!nextHeading.getAttribute("tabindex")){nextHeading.setAttribute("tabindex","-1")}nextHeading.focus();nextHeading.addEventListener("blur",(function handler(){nextHeading.removeAttribute("tabindex");nextHeading.removeEventListener("blur",handler)}))};var placeCursorAndScrollToCursor=function placeCursorAndScrollToCursor(target){var targetTagName=target.tagName.toLowerCase();setTimeout((function(){target.focus();if(targetTagName==="input"||targetTagName==="textarea"){var valueLength=target.value.length;target.selectionStart=valueLength;target.selectionEnd=valueLength;target.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}else if(target.contentEditable==="true"||target.contentEditable==="plaintext-only"){var range=document.createRange();var sel=window.getSelection();range.selectNodeContents(target);range.collapse(false);sel.removeAllRanges();sel.addRange(range);var rect=range.getBoundingClientRect();if(rect.bottom>window.innerHeight||rect.top<0){target.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}}),0)};var filterRemainingOverlays=function filterRemainingOverlays(e){document.querySelectorAll(".openKeyNav-label").forEach((function(overlay){var label=overlay.textContent;if(!label.startsWith(_this6.config.typedLabel)){var targetElement=document.querySelector('[data-openkeynav-label="'.concat(label,'"]'));targetElement&&targetElement.removeAttribute("data-openkeynav-label");overlay.remove()}}));if(document.querySelectorAll(".openKeyNav-label").length==0){doEscape(e);return true}};var disableScrolling=function disableScrolling(){var disableScrollingForEl=function disableScrollingForEl(el){el.addEventListener("scroll",_this6.preventScroll,{passive:false});el.addEventListener("wheel",_this6.preventScroll,{passive:false});el.addEventListener("touchmove",_this6.preventScroll,{passive:false})};var disableScrollingForScrollableElements=function disableScrollingForScrollableElements(){disableScrollingForEl(window);_this6.getScrollableElements().forEach((function(el){disableScrollingForEl(el)}))};disableScrollingForScrollableElements()};var generateValidKeyChars=function generateValidKeyChars(){var chars="abcdefghijklmnopqrstuvwxyz";chars=chars.replace(_this6.config.keys.escape,"");return chars};var generateLabels=function generateLabels(count){function shuffle(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var _ref2=[array[j],array[i]];array[i]=_ref2[0];array[j]=_ref2[1]}return array}var labels=[];var chars=generateValidKeyChars();var maxLength=Math.pow(chars.length,2);var useThirdChar=count>maxLength;if(useThirdChar){maxLength=Math.pow(chars.length,3)}for(var i=0;i<count&&labels.length<maxLength;i++){var firstChar=chars[i%chars.length];var secondChar=chars[Math.floor(i/chars.length)%chars.length]||"";var thirdChar=useThirdChar?chars[Math.floor(i/Math.pow(chars.length,2))%chars.length]:"";labels.push(firstChar+secondChar+thirdChar)}var labelCounts={};labels.forEach((function(label){var firstChar=label[0];labelCounts[firstChar]=(labelCounts[firstChar]||0)+1}));labels=labels.map((function(label){var firstChar=label[0];if(labelCounts[firstChar]===1&&!label.includes(".")){return firstChar}return label}));return labels};var isTabbable=function isTabbable(el){var clickableElements=["a","button","textarea","select","input","iframe","summary","[onclick]"];var interactiveRoles=["button","link","menuitem","option","tab","treeitem","checkbox","radio"];var isTypicallyClickableElement=function isTypicallyClickableElement(el){if(el.matches(clickableElements.join())){return true}var role=el.getAttribute("role");if(role&&interactiveRoles.includes(role)){return true}return false};var isHiddenByOverflow=function isHiddenByOverflow(element){var parent=element.parentNode;var doc=element.ownerDocument;var body=doc.body;while(parent&&parent!==body){var parentStyle=getComputedStyle(parent);if(["scroll","auto"].includes(parentStyle.overflow)||["scroll","auto"].includes(parentStyle.overflowX)||["scroll","auto"].includes(parentStyle.overflowY)){var parentRect=parent.getBoundingClientRect();var rect=element.getBoundingClientRect();if(rect.bottom<parentRect.top||rect.top>parentRect.bottom||rect.right<parentRect.left||rect.left>parentRect.right){return true}}parent=parent.parentNode}return false};var inViewport=function inViewport(el){var rect=el.getBoundingClientRect();var isInViewport=rect.top<window.innerHeight&&rect.left<window.innerWidth&&rect.bottom>0&&rect.right>0;return isInViewport};if(!(el instanceof Element)){return false}var style=getComputedStyle(el);if(style.display==="none"){return false}if(isHiddenByOverflow(el)){return false}if(el.matches("details:not([open]) *")&&!el.matches("details:not([open]) > summary, details:not([open]) > summary *")){return false}var tabIndex=el.getAttribute("tabindex");if(tabIndex&&parseInt(tabIndex,10)>-1){return true}if(style.visibility==="hidden"){return false}if(!_this6.isNonzeroSize(el)){return false}if(!inViewport(el)){return false}if(!_this6.config.debug.screenReaderVisible){if(!_this6.isTopLeftCornerVisible(el)){return false}}if(el.tagName.toLowerCase()==="summary"){var details=el.parentElement;if(details.tagName.toLowerCase()==="details"&&details.querySelector("summary")!==el){return false}}if(tabIndex&&parseInt(tabIndex,10)==-1){if(isTypicallyClickableElement(el)){_this6.flagAsInaccessible(el,"\n                <h2>Inaccessible Element</h2>\n                <h3>Problem: </h3>\n                <p>This element is not keyboard-focusable.</p>\n                <h3>Solution: </h3>\n                <p>Since this element has a tabindex attribute set to -1, it cannot be keyboard focusable.</p>\n                <p>It must have a tabindex set to a value &gt; -1, ideally 0.</p>\n                <p>You can ignore this warning if this element is not meant to be clickable.</p>\n                ","keyboard")}}var role=el.getAttribute("role");switch(el.tagName.toLowerCase()){case"a":if(!el.hasAttribute("href")||el.getAttribute("href")===""){if(!interactiveRoles.includes(role)){_this6.flagAsInaccessible(el,"\n                    <h2>Inaccessible Button</h2>\n                    <h3>Problem: </h3>\n                    <p>This clickable button is not keyboard-focusable.</p>\n                    <p>As a result, only mouse users can click on it.</p>\n                    <p>This usability disparity can create an accessibility barrier.</p>\n                    <h3>Solution: </h3>\n                    <p>Since it is an anchor tag (&lt;a&gt;), it needs a non-empty <em>href</em> attribute.</p>\n                    <p>Alternatively, it needs an ARIA <em>role</em> attribute set to something like 'button' or 'link' AND a tabindex attribute set to a value &gt; -1, ideally 0.</p>\n                    ","keyboard")}}break;case"button":case"textarea":case"select":case"input":case"iframe":case"summary":break;default:if(!interactiveRoles.includes(role)){var fromClickEvents="";if(_this6.config.modesConfig.click.clickEventElements.has(el)){fromClickEvents="fromClickEvents"}_this6.flagAsInaccessible(el,"\n                \x3c!--\n                  !el(a,button,textarea,select,input,iframe,summary)\n                  !el[role('button', 'link', 'menuitem', 'option', 'tab', 'treeitem', 'checkbox', 'radio')]\n                  fromClickEvents\n                --\x3e\n                <h2>Possibly Inaccessible Clickable Element</h2>\n                <h3>Problem: </h3>\n                <p>This element has a mouse click event handler attached to it, but it is not keyboard-focusable.</p>\n                <p>As a result, only mouse users can click on it.</p>\n                <p>This usability disparity can create an accessibility barrier.</p>\n                <h3>Solution Options: </h3>\n                <ol>\n                  <li>\n                    <p>If clicking this element takes the user to a different location, convert this element to an anchor link (&lt;a&gt;) with a non-empty <em>href</em> attribute.</p>\n                  </li>\n                  <li>\n                    <p>Otherwise if clicking this element triggers an action on the page, convert this element to a &lt;button&gt; without a <em>disabled</em> attribute.</p>\n                    <p>Alternatively, it needs an ARIA <em>role</em> attribute set to something like 'button' or 'link' AND a tabindex attribute set to a value &gt; -1, ideally 0.</p>\n                  </li>\n                  <li>\n                    <p>Otherwise, if clicking this element does not do anything, then consider removing the click event handler attached to this element.</p>\n                  </li>\n                </ol>\n                ","keyboard")}break}return true};var _getAllCandidateElements=function getAllCandidateElements(doc){var allElements=Array.from(doc.querySelectorAll("a,"+"button:not([disabled]),"+"textarea:not([disabled]),"+"select:not([disabled]),"+"input:not([disabled]),"+"iframe,"+"details > summary,"+"[role=button],"+"[role=link],"+"[role=menuitem],"+"[role=option],"+"[role=tab],"+"[role=treeitem],"+"[role=checkbox],"+"[role=radio],"+"[aria-checked],"+"[contenteditable=true],"+"[contenteditable=plaintext-only],"+"[tabindex],"+"[onclick]"));var iframes=doc.querySelectorAll("iframe");iframes.forEach((function(iframe){try{var iframeDoc=iframe.contentDocument||iframe.contentWindow.document;var iframeElements=_getAllCandidateElements(iframeDoc);allElements=allElements.concat(Array.from(iframeElements))}catch(error){console.log("Access denied to iframe content:",error)}}));var mergedSet=new Set([].concat(_toConsumableArray(allElements),_toConsumableArray(_this6.config.modesConfig.click.clickEventElements)));return Array.from(mergedSet)};var showClickableOverlays=function showClickableOverlays(){disableScrolling();setTimeout((function(){var clickables=_getAllCandidateElements(document).filter((function(el){return isTabbable(el)}));var labels=generateLabels(clickables.length);clickables.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));clickables.forEach((function(element,index){_this6.createOverlay(element,labels[index])}))}),0)};var addKeydownEventListenerToIframe=function addKeydownEventListenerToIframe(iframe){try{var iframeDoc=iframe.contentDocument||iframe.contentWindow.document;var potentialTarget=iframeDoc.querySelector('[data-openkeynav-label="'.concat(_this6.config.typedLabel,'"]'));if(potentialTarget){target=potentialTarget;if(!iframeDoc.keypressListenerAdded){var script=iframeDoc.createElement("script");script.textContent=""+"document.addEventListener('keydown', function(event) {"+"window.parent.postMessage({"+"type: 'keydown',"+"key: event.key,"+"keyCode: event.keyCode,"+"altKey: event.altKey,"+"ctrlKey: event.ctrlKey,"+"shiftKey: event.shiftKey,"+"metaKey: event.metaKey"+"}, '*');"+"});"+"document.keypressListenerAdded = true;";iframeDoc.body.appendChild(script)}}}catch(error){console.log("Error accessing iframe content",error)}};var showMoveableFromOverlays=function showMoveableFromOverlays(){var moveables=[];var fromElementSelectors=_toConsumableArray(new Set(_this6.config.modesConfig.move.config.filter((function(config){return config.fromElements})).map((function(config){return config.fromElements}))));if(!!fromElementSelectors.length){document.querySelectorAll(fromElementSelectors.join(", ")).forEach((function(element){var config=_this6.config.modesConfig.move.config.find((function(c){return element.matches(c.fromElements)}));if(config){var configKey=_this6.config.modesConfig.move.config.indexOf(config);if(_this6.isNonzeroSize(element)&&(!config.fromExclude||!element.matches(config.fromExclude))){element.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(element)}}}))}var fromContainerSelectors=_toConsumableArray(new Set(_this6.config.modesConfig.move.config.filter((function(config){return config.fromContainer})).map((function(config){return config.fromContainer}))));if(!!fromContainerSelectors.length){var fromContainers=document.querySelectorAll(fromContainerSelectors.join(", "));fromContainers.forEach((function(container){var config=_this6.config.modesConfig.move.config.find((function(c){return container.matches(c.fromContainer)}));if(config){var configKey=_this6.config.modesConfig.move.config.indexOf(config);var children=Array.from(container.children);children.forEach((function(child){if(_this6.isNonzeroSize(child)&&(!config.fromExclude||!child.matches(config.fromExclude))){child.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(child)}}))}}))}_this6.config.modesConfig.move.config.forEach((function(config){if(config.resolveFromElements){var resolvedElements=config.resolveFromElements();resolvedElements.forEach((function(element){var configKey=_this6.config.modesConfig.move.config.indexOf(config);if(_this6.isNonzeroSize(element)&&(!config.fromExclude||!element.matches(config.fromExclude))){element.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(element)}}))}}));moveables=moveables.filter((function(el){return isTabbable(el)}));var labels=generateLabels(moveables.length);moveables.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));moveables.forEach((function(element,index){_this6.createOverlay(element,labels[index]);element.setAttribute("data-openkeynav-draggable","true")}))};var handleTargetClickInteraction=function handleTargetClickInteraction(target,e){var doc=target.ownerDocument;var win=doc.defaultView||doc.parentWindow;var target_tagName=target.tagName.toLowerCase();if(target_tagName==="input"||target_tagName==="textarea"||target.contentEditable==="true"||target.contentEditable==="plaintext-only"||target.hasAttribute("tabindex")&&target.tabIndex>-1){target.focus();placeCursorAndScrollToCursor(target)}else{if(e.shiftKey&&target.tagName.toLowerCase()==="a"&&target.href){win.open(target.href,"_blank")}else{target.focus();if(!_this6.config.modesConfig.click.modifier){var clickEvent=new MouseEvent("click",{bubbles:true,cancelable:true,view:win});target.dispatchEvent(clickEvent)}}}_this6.removeOverlays();_this6.clearMoveAttributes()};var moveSelectedMoveableToTarget=function moveSelectedMoveableToTarget(selectedTarget){console.log("Selected move target:",selectedTarget);_this6.config.modesConfig.move.selectedDropZone=selectedTarget;var callback=_this6.config.modesConfig.move.config[_this6.config.modesConfig.move.selectedConfig].callback;if(!callback){simulateDragAndDrop(_this6.config.modesConfig.move.selectedMoveable,_this6.config.modesConfig.move.selectedDropZone)}else{_this6.config.modesConfig.move.config[_this6.config.modesConfig.move.selectedConfig].callback(_this6.config.modesConfig.move.selectedMoveable,_this6.config.modesConfig.move.selectedDropZone)}if(!_this6.config.modesConfig.move.modifier){_this6.removeOverlays(true);_this6.clearMoveAttributes()}return true};var handleClickMode=function handleClickMode(e){e.preventDefault();_this6.config.typedLabel+=e.key.toLowerCase();var target=document.querySelector('[data-openkeynav-label="'.concat(_this6.config.typedLabel,'"]'));if(!target){document.querySelectorAll("iframe").forEach((function(iframe){addKeydownEventListenerToIframe(iframe)}))}if(target){setTimeout((function(){handleTargetClickInteraction(target,e)}),0)}else{filterRemainingOverlays(e);return false}return true};var handleMoveMode=function handleMoveMode(e){var showMoveableToOverlays=function showMoveableToOverlays(selectedMoveable){var modifer=_this6.config.modesConfig.move.modifier;_this6.removeOverlays();_this6.config.modes.moving=true;_this6.config.modesConfig.move.selectedMoveable=selectedMoveable;_this6.config.modesConfig.move.selectedMoveableHTML=selectedMoveable.innerHTML;_this6.config.modesConfig.move.modifier=modifer;var configIndex=selectedMoveable.getAttribute("data-openkeynav-moveconfig");if(configIndex===null)return;var configKeyForSelectedMoveable=parseInt(configIndex,10);_this6.config.modesConfig.move.selectedConfig=configKeyForSelectedMoveable;var moveConfig=_this6.config.modesConfig.move.config[configKeyForSelectedMoveable];if(!moveConfig)return;var targetElements=[].filter.call(document.querySelectorAll(moveConfig.toElements),isTabbable);var labels=generateLabels(targetElements.length);targetElements.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));targetElements.forEach((function(element,index){if(!_this6.isNonzeroSize(element))return;_this6.createOverlay(element,labels[index]);element.setAttribute("data-openkeynav-dropzone","true")}))};function findMatchingElements(queryString){return Array.from(document.querySelectorAll(queryString))}function findElementWithQuery(startElement,queryString){var direction=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"next";var currentElement=startElement;while(currentElement){if(direction==="previous"){currentElement=currentElement.previousElementSibling;while(!currentElement&&startElement.parentElement){currentElement=startElement.parentElement.previousElementSibling;startElement=startElement.parentElement}if(currentElement){var descendants=currentElement.querySelectorAll(queryString);if(descendants.length>0){return descendants[descendants.length-1]}if(currentElement.matches(queryString)){return currentElement}}}else if(direction==="next"){currentElement=currentElement.nextElementSibling;while(!currentElement&&startElement.parentElement){currentElement=startElement.parentElement.nextElementSibling;startElement=startElement.parentElement}if(currentElement){if(currentElement.matches(queryString)){return currentElement}var foundElement=currentElement.querySelector(queryString);if(foundElement){return foundElement}}}else{throw new Error("Invalid direction. Use 'previous' or 'next'.")}}return null}function cycleThroughMoveTargets(event){event.preventDefault();var direction="next";if(event.shiftKey){direction="previous"}return findElementWithQuery(openKeyNav.config.modesConfig.move.selectedMoveable,"[data-openkeynav-label]:not(.openKeyNav-label)",direction)}var validLabelChars=generateValidKeyChars();var isValidLabelChar=Array.from(validLabelChars).some((function(validChar){return validChar.toLowerCase()==e.key.toLowerCase()}));var selectedTarget;if(isValidLabelChar){_this6.config.typedLabel+=e.key.toLowerCase();selectedTarget=document.querySelector('[data-openkeynav-label="'.concat(_this6.config.typedLabel,'"]:not(.openKeyNav-label)'))}else{if(e.key==="Tab"){var queryString=".openKeyNav-label:not(.openKeyNav-label-selected)";selectedTarget=cycleThroughMoveTargets(e)}}if(!selectedTarget){filterRemainingOverlays(e);return false}if(!_this6.config.modesConfig.move.selectedMoveable){console.log("Selected element to move:",selectedTarget);showMoveableToOverlays(selectedTarget);beginDrag();return true}moveSelectedMoveableToTarget(selectedTarget);return true};var simulateDragAndDrop=function simulateDragAndDrop(sourceElement,targetElement){var handleStickyMove=function handleStickyMove(){function findMatchingElementByHTML(htmlString){function removeComments(htmlString){return htmlString.replace(/<!--[\s\S]*?-->/g,"")}var cleanedHTMLString=removeComments(htmlString);var allElements=document.querySelectorAll("*");var _iterator=_createForOfIteratorHelper(allElements),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var element=_step.value;var cleanedElementHTML=removeComments(element.innerHTML);if(cleanedElementHTML===cleanedHTMLString){return element}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return null}if(!_this6.config.modesConfig.move.modifier){return false}_this6.config.typedLabel="";_this6.config.modesConfig.move.selectedDropZone=false;if(!document.contains(_this6.config.modesConfig.move.selectedMoveable)){var matchingElement=findMatchingElementByHTML(_this6.config.modesConfig.move.selectedMoveableHTML);var selectedConfig=_this6.config.modesConfig.move.config[_this6.config.modesConfig.move.selectedConfig];var passesInclusionCriteria=matchingElement&&matchingElement.matches(selectedConfig.fromElements)||matchingElement.matches(selectedConfig.fromContainer+" > *");var passesExclusionCriteria=matchingElement&&!matchingElement.matches(selectedConfig.fromExclude);if(passesInclusionCriteria&&passesExclusionCriteria){console.log("Matching element found:",matchingElement);_this6.config.modesConfig.move.selectedMoveable=matchingElement;_this6.config.modesConfig.move.selectedMoveableHTML=matchingElement.innerHTML;_this6.updateOverlayPosition(matchingElement,_this6.config.modesConfig.move.selectedLabel);beginDrag()}else{console.log("No matching element found.");_this6.removeOverlays(true);_this6.clearMoveAttributes()}}};endDrag(targetElement);handleStickyMove()};document.addEventListener("keydown",(function(e){switch(e.key){case"Shift":case"Control":case"Alt":case"Meta":case" ":return true;break;case"Escape":doEscape(e);break}if(_this6.config.modes.clicking){return handleClickMode(e)}if(_this6.config.modes.moving){return handleMoveMode(e)}if(_this6.isTextInputActive()){if(!e.ctrlKey){return true}}switch(e.key){case _this6.config.keys.escape:doEscape(e);return true;break}switch(e.key){case _this6.config.keys.click:case _this6.config.keys.click.toUpperCase():e.preventDefault();_this6.config.modes.clicking=true;if(e.key==_this6.config.keys.click.toUpperCase()){_this6.config.modesConfig.click.modifier=true}showClickableOverlays();return true;break;case _this6.config.keys.move:case _this6.config.keys.move.toUpperCase():e.preventDefault();_this6.config.modes.moving=true;if(e.key==_this6.config.keys.move.toUpperCase()){_this6.config.modesConfig.move.modifier=true}showMoveableFromOverlays();return true;default:break}switch(e.key.toLowerCase()){case _this6.config.keys.heading.toLowerCase():e.preventDefault();focusOnHeadings("h1, h2, h3, h4, h5, h6",e);return true;break;case _this6.config.keys.scroll.toLowerCase():e.preventDefault();focusOnScrollables(e);return true;break;default:break}var numberMap={Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0"};if(e.code){var numberPressed=numberMap[e.code];switch(numberPressed){case _this6.config.keys.heading_1:e.preventDefault();focusOnHeadings("h1",e);break;case _this6.config.keys.heading_2:e.preventDefault();focusOnHeadings("h2",e);break;case _this6.config.keys.heading_3:e.preventDefault();focusOnHeadings("h3",e);break;case _this6.config.keys.heading_4:e.preventDefault();focusOnHeadings("h4",e);break;case _this6.config.keys.heading_5:e.preventDefault();focusOnHeadings("h5",e);break;case _this6.config.keys.heading_6:e.preventDefault();focusOnHeadings("h6",e);break;default:break}}}),true);window.addEventListener("message",(function(e){if(e.data.type==="keydown"){console.log("Key pressed in iframe:",e.data.key);var newEvent=new KeyboardEvent("keydown",{key:e.data.key,keyCode:e.data.keyCode,altKey:e.data.altKey,ctrlKey:e.data.ctrlKey,shiftKey:e.data.shiftKey,metaKey:e.data.metaKey,bubbles:true,cancelable:true});if(newEvent.key==="Escape"){doEscape(e)}document.dispatchEvent(newEvent)}}))}},{key:"applicationSupport",value:function applicationSupport(){try{fetch("https://applicationsupport.openkeynav.com/capture/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({properties:{version:version,timestamp:(new Date).toISOString()},api_key:"phc_2NVfXaBIYnZxYzEQtMJCuwB4rDbmjKkeCxlVZMK7x12",event:"openKeyNav.js version ping",distinct_id:"openKeyNav.js"})})}catch(error){}}},{key:"setupGlobalClickListenerTracking",value:function setupGlobalClickListenerTracking(){var clickEventElements=this.config.modesConfig.click.clickEventElements;var originalAddEventListener=EventTarget.prototype.addEventListener;var originalRemoveEventListener=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(type,listener,options){if(type==="click"){var isEmptyFunction=listener&&/^\s*function\s*\(\)\s*\{\s*\}\s*$/.test(listener.toString());if(!isEmptyFunction){clickEventElements.add(this)}}return originalAddEventListener.call(this,type,listener,options)};EventTarget.prototype.removeEventListener=function(type,listener,options){if(type==="click"){var remainingListeners=getEventListeners(this,"click").filter((function(l){return l.listener!==listener}));if(remainingListeners.length===0){clickEventElements["delete"](this)}}return originalRemoveEventListener.call(this,type,listener,options)};var observer=new MutationObserver((function(mutationsList){var _iterator2=_createForOfIteratorHelper(mutationsList),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var mutation=_step2.value;if(mutation.removedNodes.length>0){mutation.removedNodes.forEach((function(node){if(node.nodeType===Node.ELEMENT_NODE){removeDescendantsFromSet(node)}}))}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}));observer.observe(document.body,{childList:true,subtree:true});function removeDescendantsFromSet(element){if(clickEventElements.has(element)){clickEventElements["delete"](element)}element.querySelectorAll("*").forEach((function(child){if(clickEventElements.has(child)){clickEventElements["delete"](child)}}))}function getEventListeners(el,eventType){var listeners=[];var eventKey="__eventListener__".concat(eventType);if(el[eventKey]){listeners.push({listener:el[eventKey]})}return listeners}}},{key:"init",value:function init(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.deepMerge(this.config,options);this.injectStylesheet();this.addKeydownEventListener();this.setupGlobalClickListenerTracking();this.applicationSupport();console.log("Library initialized with config:",this.config)}}])}();var _default=exports["default"]=OpenKeyNav;