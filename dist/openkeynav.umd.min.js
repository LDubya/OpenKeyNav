(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,global.OpenKeyNav=factory())})(this,(function(){"use strict";var OpenKeyNav$1={};var version={};Object.defineProperty(version,"__esModule",{value:true});version.version=void 0;version.version="0.1.227";var signals={};Object.defineProperty(signals,"__esModule",{value:true});signals.derived=derived;signals.effect=effect;signals.signal=signal;var subscriber=null;function signal(value){var subscriptions=new Set;return{get value(){if(subscriber){subscriptions.add(subscriber)}return value},set value(updated){value=updated;subscriptions.forEach((function(fn){return fn()}))}}}function effect(fn){subscriber=fn;fn();subscriber=null}function derived(fn){var derived=signal();effect((function(){derived.value=fn()}));return derived}var toolbar={};var keyButton={};Object.defineProperty(keyButton,"__esModule",{value:true});keyButton.keyButton=void 0;keyButton.keyButton=function keyButton(keyCodes,text,reverseOrder){var styledKeyCodes=keyCodes.map((function(keyCode){return'<span class="keyButton">'.concat(keyCode,"</span>")})).join("");if(!text){return"".concat(styledKeyCodes)}if(reverseOrder){return'\n            <span class="keyButtonContainer"> \n                <span>\n                    '.concat(styledKeyCodes,'\n                </span>\n                <span class="keyButtonLabel">').concat(text,"</span> \n            </span>\n        ")}return'\n        <span class="keyButtonContainer"> \n            <span class="keyButtonLabel">'.concat(text,"</span> \n            <span>\n                ").concat(styledKeyCodes,"\n            </span>\n        </span>\n    ")};var keypress={};var clicking={};Object.defineProperty(clicking,"__esModule",{value:true});clicking.placeCursorAndScrollToCursor=clicking.handleTargetClickInteraction=void 0;clicking.handleTargetClickInteraction=function handleTargetClickInteraction(openKeyNav,target,e){var doc=target.ownerDocument;var win=doc.defaultView||doc.parentWindow;var target_tagName=target.tagName.toLowerCase();if(target_tagName==="input"||target_tagName==="textarea"||target.contentEditable==="true"||target.contentEditable==="plaintext-only"||target.hasAttribute("tabindex")&&target.tabIndex>-1){target.focus();placeCursorAndScrollToCursor(target)}else{if(e.shiftKey&&target.tagName.toLowerCase()==="a"&&target.href){win.open(target.href,"_blank")}else{target.focus();if(!openKeyNav.config.modesConfig.click.modifier){var clickEvent=new MouseEvent("click",{bubbles:true,cancelable:true,view:win});target.dispatchEvent(clickEvent)}}}openKeyNav.removeOverlays();openKeyNav.clearMoveAttributes()};var placeCursorAndScrollToCursor=clicking.placeCursorAndScrollToCursor=function placeCursorAndScrollToCursor(target){var targetTagName=target.tagName.toLowerCase();setTimeout((function(){target.focus();if(targetTagName==="input"&&["text","search","url","tel","email","password"].indexOf(target.type)>-1||targetTagName==="textarea"){var valueLength=target.value.length;target.selectionStart=valueLength;target.selectionEnd=valueLength;target.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}else if(target.contentEditable==="true"||target.contentEditable==="plaintext-only"){var range=document.createRange();var sel=window.getSelection();range.selectNodeContents(target);range.collapse(false);sel.removeAllRanges();sel.addRange(range);var rect=range.getBoundingClientRect();if(rect.bottom>window.innerHeight||rect.top<0){target.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}}}),0)};var dragAndDrop={};Object.defineProperty(dragAndDrop,"__esModule",{value:true});dragAndDrop.simulateDragAndDrop=dragAndDrop.endDrag=dragAndDrop.beginDrag=void 0;function _createForOfIteratorHelper$2(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray$3(r))||e){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _unsupportedIterableToArray$3(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray$3(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray$3(r,a):void 0}}function _arrayLikeToArray$3(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}dragAndDrop.simulateDragAndDrop=function simulateDragAndDrop(openKeyNav,sourceElement,targetElement){var handleStickyMove=function handleStickyMove(){function findMatchingElementByHTML(htmlString){function removeComments(htmlString){return htmlString.replace(/<!--[\s\S]*?-->/g,"")}var cleanedHTMLString=removeComments(htmlString);var allElements=document.querySelectorAll("*");var _iterator=_createForOfIteratorHelper$2(allElements),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var element=_step.value;var cleanedElementHTML=removeComments(element.innerHTML);if(cleanedElementHTML===cleanedHTMLString){return element}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return null}if(!openKeyNav.config.modesConfig.move.modifier){return false}openKeyNav.config.typedLabel.value="";openKeyNav.config.modesConfig.move.selectedDropZone=false;if(!document.contains(openKeyNav.config.modesConfig.move.selectedMoveable)){var matchingElement=findMatchingElementByHTML(openKeyNav.config.modesConfig.move.selectedMoveableHTML);var selectedConfig=openKeyNav.config.modesConfig.move.config[openKeyNav.config.modesConfig.move.selectedConfig];var passesInclusionCriteria=matchingElement&&matchingElement.matches(selectedConfig.fromElements)||matchingElement.matches(selectedConfig.fromContainer+" > *");var passesExclusionCriteria=matchingElement&&!matchingElement.matches(selectedConfig.fromExclude);if(passesInclusionCriteria&&passesExclusionCriteria){console.log("Matching element found:",matchingElement);openKeyNav.config.modesConfig.move.selectedMoveable=matchingElement;openKeyNav.config.modesConfig.move.selectedMoveableHTML=matchingElement.innerHTML;openKeyNav.updateOverlayPosition(matchingElement,openKeyNav.config.modesConfig.move.selectedLabel);beginDrag(openKeyNav)}else{console.log("No matching element found.");openKeyNav.removeOverlays(true);openKeyNav.clearMoveAttributes()}}};endDrag(openKeyNav,targetElement);handleStickyMove()};var endDrag=dragAndDrop.endDrag=function endDrag(openKeyNav,targetElement){var dataTransfer=new DataTransfer;var clientX=0;var clientY=0;var sourceElement=openKeyNav.config.modesConfig.move.selectedMoveable;if(typeof TouchEvent==="undefined"){openKeyNav.setupTouchEvent()}if(!sourceElement){sourceElement=document.body}if(!targetElement){targetElement=document.body}var rectTarget=targetElement.getBoundingClientRect();if(targetElement!=document){clientX=rectTarget.left+rectTarget.width/2;clientY=rectTarget.top+rectTarget.height/2}var mouseMoveEvent=new MouseEvent("mousemove",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY});var touchMoveEvent=new TouchEvent("touchmove",{bubbles:true,cancelable:true,touches:[new Touch({identifier:Date.now(),target:targetElement,clientX:clientX,clientY:clientY})]});var dragEnterEvent=new DragEvent("dragenter",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragEnterEvent,"dataTransfer",{value:dataTransfer});var dragOverEvent=new DragEvent("dragover",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragOverEvent,"dataTransfer",{value:dataTransfer});var dropEvent=new DragEvent("drop",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dropEvent,"dataTransfer",{value:dataTransfer});var dragEndEvent=new DragEvent("dragend",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY,dataTransfer:dataTransfer});Object.defineProperty(dragEndEvent,"dataTransfer",{value:dataTransfer});var mouseUpEvent=new MouseEvent("mouseup",{bubbles:true,cancelable:true,clientX:clientX,clientY:clientY});var touchEndEvent=new TouchEvent("touchend",{bubbles:true,cancelable:true,changedTouches:[new Touch({identifier:Date.now(),target:targetElement,clientX:clientX,clientY:clientY})]});try{document.dispatchEvent(mouseMoveEvent)}catch(error){console.log(error)}try{document.dispatchEvent(touchMoveEvent)}catch(error){console.log(error)}try{targetElement.dispatchEvent(dragEnterEvent)}catch(error){console.log(error)}try{targetElement.dispatchEvent(dragOverEvent)}catch(error){console.log(error)}try{if(targetElement!=document){targetElement.dispatchEvent(dropEvent)}}catch(error){console.log(error)}try{sourceElement.dispatchEvent(dragEndEvent)}catch(error){console.log(error)}targetElement.dispatchEvent(mouseUpEvent);targetElement.dispatchEvent(touchEndEvent)};var beginDrag=dragAndDrop.beginDrag=function beginDrag(openKeyNav){var sourceElement=openKeyNav.config.modesConfig.move.selectedMoveable;var rectSource=sourceElement.getBoundingClientRect();var dataTransfer=new DataTransfer;if(typeof TouchEvent==="undefined"){openKeyNav.setupTouchEvent()}var mouseDownEvent=new MouseEvent("mousedown",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2,clientY:rectSource.top+rectSource.height/2});sourceElement.dispatchEvent(mouseDownEvent);var touchStartEvent=new TouchEvent("touchstart",{bubbles:true,cancelable:true,touches:[new Touch({identifier:Date.now(),target:sourceElement,clientX:rectSource.left+rectSource.width/2,clientY:rectSource.top+rectSource.height/2})]});sourceElement.dispatchEvent(touchStartEvent);var mouseMoveEvent=new MouseEvent("mousemove",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2+10,clientY:rectSource.top+rectSource.height/2+10});document.dispatchEvent(mouseMoveEvent);var dragStartEvent=new DragEvent("dragstart",{bubbles:true,cancelable:true,clientX:rectSource.left+rectSource.width/2+10,clientY:rectSource.top+rectSource.height/2+10,dataTransfer:dataTransfer});Object.defineProperty(dragStartEvent,"dataTransfer",{value:dataTransfer});sourceElement.dispatchEvent(dragStartEvent)};var _escape$3={};Object.defineProperty(_escape$3,"__esModule",{value:true});_escape$3.handleEscape=void 0;var _dragAndDrop$1=dragAndDrop;_escape$3.handleEscape=function handleEscape(openKeyNav,e){var returnFalse=false;if(openKeyNav.config.modes.clicking.value||openKeyNav.config.modes.moving.value||openKeyNav.config.modes.menu.value){e.preventDefault();e.stopPropagation();(0,_dragAndDrop$1.endDrag)(openKeyNav);openKeyNav.removeOverlays();openKeyNav.clearMoveAttributes();returnFalse=true}if(openKeyNav.isTextInputActive()){document.activeElement.blur()}if(returnFalse){return false}else{if(document.activeElement!=document.body){document.activeElement.blur()}}};var focus={};Object.defineProperty(focus,"__esModule",{value:true});focus.focusOnScrollables=focus.focusOnHeadings=void 0;focus.focusOnHeadings=function focusOnHeadings(openKeyNav,headings,e){openKeyNav.config.headings.list=Array.from(document.querySelectorAll(headings)).filter((function(el){var style=getComputedStyle(el);if(style.display==="none"||style.visibility==="hidden")return false;if(!openKeyNav.config.debug.screenReaderVisible){if(!openKeyNav.isAnyCornerVisible(el)){return false}}return true}));if(openKeyNav.config.headings.list.length==0){return true}if(e.shiftKey){if(openKeyNav.config.headings.currentHeadingIndex>0){openKeyNav.config.headings.currentHeadingIndex--}else{openKeyNav.config.headings.currentHeadingIndex=openKeyNav.config.headings.list.length-1}}else{if(openKeyNav.config.headings.currentHeadingIndex<openKeyNav.config.headings.list.length-1){openKeyNav.config.headings.currentHeadingIndex++}else{openKeyNav.config.headings.currentHeadingIndex=0}}var nextHeading=openKeyNav.config.headings.list[openKeyNav.config.headings.currentHeadingIndex];if(!nextHeading.hasAttribute("tabindex")){nextHeading.setAttribute("tabindex","-1");nextHeading.setAttribute("data-openkeynav-tabIndexed",true)}nextHeading.focus();nextHeading.setAttribute("data-openkeynav-focused",true);nextHeading.addEventListener("blur",(function handler(){if(nextHeading.hasAttribute("data-openkeynav-tabIndexed")){nextHeading.removeAttribute("tabindex");nextHeading.removeAttribute("data-openkeynav-tabIndexed")}nextHeading.removeAttribute("data-openkeynav-focused");nextHeading.removeEventListener("blur",handler)}))};focus.focusOnScrollables=function focusOnScrollables(openKeyNav,e){openKeyNav.config.scrollables.list=openKeyNav.getScrollableElements();if(openKeyNav.config.scrollables.list.length==0){return}{if(e.shiftKey){openKeyNav.config.currentScrollableIndex=openKeyNav.config.currentScrollableIndex>0?openKeyNav.config.currentScrollableIndex-1:openKeyNav.config.scrollables.list.length-1}else{openKeyNav.config.currentScrollableIndex=openKeyNav.config.currentScrollableIndex<openKeyNav.config.scrollables.list.length-1?openKeyNav.config.currentScrollableIndex+1:0}}var currentScrollable=openKeyNav.config.scrollables.list[openKeyNav.config.currentScrollableIndex];if(!currentScrollable.hasAttribute("tabindex")){currentScrollable.setAttribute("tabindex","-1");currentScrollable.setAttribute("data-openkeynav-tabIndexed",true)}currentScrollable.focus();currentScrollable.setAttribute("data-openkeynav-focused",true);currentScrollable.addEventListener("blur",(function handler(){if(currentScrollable.hasAttribute("data-openkeynav-tabIndexed")){currentScrollable.removeAttribute("tabindex");currentScrollable.removeAttribute("data-openkeynav-tabIndexed")}currentScrollable.removeAttribute("data-openkeynav-focused");currentScrollable.removeEventListener("blur",handler)}))};var isTabbable={};Object.defineProperty(isTabbable,"__esModule",{value:true});isTabbable.isTabbable=void 0;var isHiddenByOverflow=function isHiddenByOverflow(element){var parent=element.parentNode;var doc=element.ownerDocument;var body=doc.body;while(parent&&parent!==body){var parentStyle=getComputedStyle(parent);if(["scroll","auto"].includes(parentStyle.overflow)||["scroll","auto"].includes(parentStyle.overflowX)||["scroll","auto"].includes(parentStyle.overflowY)){var parentRect=parent.getBoundingClientRect();var rect=element.getBoundingClientRect();if(rect.bottom<parentRect.top||rect.top>parentRect.bottom||rect.right<parentRect.left||rect.left>parentRect.right){return true}}parent=parent.parentNode}return false};var inViewport=function inViewport(el){var rect=el.getBoundingClientRect();var isInViewport=rect.top<window.innerHeight&&rect.left<window.innerWidth&&rect.bottom>0&&rect.right>0;return isInViewport};isTabbable.isTabbable=function isTabbable(el,openKeyNav){var clickableElements=["a","button","textarea","select","input","iframe","summary","[onclick]"];var interactiveRoles=["button","link","menuitem","option","tab","treeitem","checkbox","radio"];var isTypicallyClickableElement=function isTypicallyClickableElement(el){if(el.matches(clickableElements.join())){return true}var role=el.getAttribute("role");if(role&&interactiveRoles.includes(role)){return true}return false};if(!(el instanceof Element)){return false}var style=getComputedStyle(el);if(style.display==="none"){return false}if(isHiddenByOverflow(el)){return false}if(el.matches("details:not([open]) *")&&!el.matches("details:not([open]) > summary, details:not([open]) > summary *")){return false}var tabIndex=el.getAttribute("tabindex");if(tabIndex&&parseInt(tabIndex,10)>-1){return true}if(style.visibility==="hidden"){return false}if(!openKeyNav.isNonzeroSize(el)){return false}if(!inViewport(el)){return false}if(!openKeyNav.config.debug.screenReaderVisible){if(!openKeyNav.isAnyCornerVisible(el)){return false}}if(el.tagName.toLowerCase()==="summary"){var details=el.parentElement;if(details&&details.tagName.toLowerCase()==="details"&&details.querySelector("summary")!==el){return false}}if(tabIndex&&parseInt(tabIndex,10)==-1){if(isTypicallyClickableElement(el)){openKeyNav.flagAsInaccessible(el,"\n            <h2>Inaccessible Element</h2>\n            <h3>Problem: </h3>\n            <p>This element is not keyboard-focusable.</p>\n            <h3>Solution: </h3>\n            <p>Since this element has a tabindex attribute set to -1, it cannot be keyboard focusable.</p>\n            <p>It must have a tabindex set to a value &gt; -1, ideally 0.</p>\n            <p>You can ignore this warning if this element is not meant to be clickable.</p>\n            ","keyboard")}}var role=el.getAttribute("role");switch(el.tagName.toLowerCase()){case"a":if(!el.hasAttribute("href")||el.getAttribute("href")===""){if(!interactiveRoles.includes(role)){openKeyNav.flagAsInaccessible(el,"\n                <h2>Inaccessible Button</h2>\n                <h3>Problem: </h3>\n                <p>This clickable button is not keyboard-focusable.</p>\n                <p>As a result, only mouse users can click on it.</p>\n                <p>This usability disparity can create an accessibility barrier.</p>\n                <h3>Solution: </h3>\n                <p>Since it is an anchor tag (&lt;a&gt;), it needs a non-empty <em>href</em> attribute.</p>\n                <p>Alternatively, it needs an ARIA <em>role</em> attribute set to something like 'button' or 'link' AND a tabindex attribute set to a value &gt; -1, ideally 0.</p>\n                ","keyboard")}}break;case"button":case"textarea":case"select":case"input":case"iframe":case"summary":break;default:if(!!role&&!interactiveRoles.includes(role)){if(openKeyNav.config.modesConfig.click.clickEventElements.has(el)){openKeyNav.flagAsInaccessible(el,"\n              \x3c!--\n                !el(a,button,textarea,select,input,iframe,summary)\n                !el[role('button', 'link', 'menuitem', 'option', 'tab', 'treeitem', 'checkbox', 'radio')]\n                fromClickEvents\n              --\x3e\n              <h2>Possibly Inaccessible Clickable Element</h2>\n              <h3>Problem: </h3>\n              <p>This element has a mouse click event handler attached to it, but it is not keyboard-focusable.</p>\n              <p>As a result, only mouse users can click on it.</p>\n              <p>This usability disparity can create an accessibility barrier.</p>\n              <h3>Solution Options: </h3>\n              <ol>\n                <li>\n                  <p>If clicking this element takes the user to a different location, convert this element to an anchor link (&lt;a&gt;) with a non-empty <em>href</em> attribute.</p>\n                </li>\n                <li>\n                  <p>Otherwise if clicking this element triggers an action on the page, convert this element to a &lt;button&gt; without a <em>disabled</em> attribute.</p>\n                  <p>Alternatively, it needs an ARIA <em>role</em> attribute set to something like 'button' or 'link' AND a tabindex attribute set to a value &gt; -1, ideally 0.</p>\n                </li>\n                <li>\n                  <p>Otherwise, if clicking this element does not do anything, then consider removing the click event handler attached to this element.</p>\n                </li>\n              </ol>\n              ","keyboard")}}break}return true};var keylabels={};var scrolling={};Object.defineProperty(scrolling,"__esModule",{value:true});scrolling.disableScrolling=void 0;scrolling.disableScrolling=function disableScrolling(openKeyNav){var disableScrollingForEl=function disableScrollingForEl(el){el.addEventListener("scroll",openKeyNav.preventScroll,{passive:false});el.addEventListener("wheel",openKeyNav.preventScroll,{passive:false});el.addEventListener("touchmove",openKeyNav.preventScroll,{passive:false})};var disableScrollingForScrollableElements=function disableScrollingForScrollableElements(){disableScrollingForEl(window);openKeyNav.getScrollableElements().forEach((function(el){disableScrollingForEl(el)}))};disableScrollingForScrollableElements()};Object.defineProperty(keylabels,"__esModule",{value:true});keylabels.showMoveableFromOverlays=keylabels.showClickableOverlays=keylabels.generateValidKeyChars=keylabels.generateLabels=keylabels.filterRemainingOverlays=void 0;var _escape$2=_escape$3;var _isTabbable$1=isTabbable;var _scrolling=scrolling;function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_unsupportedIterableToArray$2(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray$2(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray$2(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray$2(r,a):void 0}}function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray$2(r)}function _arrayLikeToArray$2(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var generateLabels=keylabels.generateLabels=function generateLabels(openKeyNav,count){var labels=[];var chars=generateValidKeyChars(openKeyNav);var maxLength=Math.pow(chars.length,2);var useThirdChar=count>maxLength;if(useThirdChar){maxLength=Math.pow(chars.length,3)}for(var i=0;i<count&&labels.length<maxLength;i++){var firstChar=chars[i%chars.length];var secondChar=chars[Math.floor(i/chars.length)%chars.length]||"";var thirdChar=useThirdChar?chars[Math.floor(i/Math.pow(chars.length,2))%chars.length]:"";labels.push(firstChar+secondChar+thirdChar)}var labelCounts={};labels.forEach((function(label){var firstChar=label[0];labelCounts[firstChar]=(labelCounts[firstChar]||0)+1}));labels=labels.map((function(label){var firstChar=label[0];if(labelCounts[firstChar]===1&&!label.includes(".")){return firstChar}return label}));return labels};keylabels.showClickableOverlays=function showClickableOverlays(openKeyNav){(0,_scrolling.disableScrolling)(openKeyNav);setTimeout((function(){var clickables=_getAllCandidateElements(openKeyNav,document).filter((function(el){return(0,_isTabbable$1.isTabbable)(el,openKeyNav)}));var labels=generateLabels(openKeyNav,clickables.length);clickables.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));clickables.forEach((function(element,index){openKeyNav.createOverlay(element,labels[index])}))}),0)};keylabels.showMoveableFromOverlays=function showMoveableFromOverlays(openKeyNav){var moveables=[];var fromElementSelectors=_toConsumableArray(new Set(openKeyNav.config.modesConfig.move.config.filter((function(config){return config.fromElements})).map((function(config){return config.fromElements}))));if(!!fromElementSelectors.length){document.querySelectorAll(fromElementSelectors.join(", ")).forEach((function(element){var config=openKeyNav.config.modesConfig.move.config.find((function(c){return element.matches(c.fromElements)}));if(config){var configKey=openKeyNav.config.modesConfig.move.config.indexOf(config);if(openKeyNav.isNonzeroSize(element)&&(!config.fromExclude||!element.matches(config.fromExclude))){element.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(element)}}}))}var fromContainerSelectors=_toConsumableArray(new Set(openKeyNav.config.modesConfig.move.config.filter((function(config){return config.fromContainer})).map((function(config){return config.fromContainer}))));if(!!fromContainerSelectors.length){var fromContainers=document.querySelectorAll(fromContainerSelectors.join(", "));fromContainers.forEach((function(container){var config=openKeyNav.config.modesConfig.move.config.find((function(c){return container.matches(c.fromContainer)}));if(config){var configKey=openKeyNav.config.modesConfig.move.config.indexOf(config);var children=Array.from(container.children);children.forEach((function(child){if(openKeyNav.isNonzeroSize(child)&&(!config.fromExclude||!child.matches(config.fromExclude))){child.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(child)}}))}}))}openKeyNav.config.modesConfig.move.config.forEach((function(config){if(config.resolveFromElements){var resolvedElements=config.resolveFromElements();resolvedElements.forEach((function(element){var configKey=openKeyNav.config.modesConfig.move.config.indexOf(config);if(openKeyNav.isNonzeroSize(element)&&(!config.fromExclude||!element.matches(config.fromExclude))){element.setAttribute("data-openkeynav-moveconfig",configKey);moveables.push(element)}}))}}));moveables=moveables.filter((function(el){return(0,_isTabbable$1.isTabbable)(el,openKeyNav)}));var labels=generateLabels(openKeyNav,moveables.length);moveables.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));moveables.forEach((function(element,index){openKeyNav.createOverlay(element,labels[index]);element.setAttribute("data-openkeynav-draggable","true")}))};keylabels.filterRemainingOverlays=function filterRemainingOverlays(openKeyNav,e){document.querySelectorAll(".openKeyNav-label").forEach((function(overlay){var label=overlay.textContent;if(!label.startsWith(openKeyNav.config.typedLabel.value)){var targetElement=document.querySelector('[data-openkeynav-label="'.concat(label,'"]'));targetElement&&targetElement.removeAttribute("data-openkeynav-label");overlay.remove()}}));if(document.querySelectorAll(".openKeyNav-label").length==0){(0,_escape$2.handleEscape)(openKeyNav,e);return true}};var generateValidKeyChars=keylabels.generateValidKeyChars=function generateValidKeyChars(openKeyNav){var chars="abcdefghijklmnopqrstuvwxyz";chars=chars.replace(openKeyNav.config.keys.escape,"");return chars};var _getAllCandidateElements=function getAllCandidateElements(openKeyNav,doc){var allElements=Array.from(doc.querySelectorAll("a,"+"button:not([disabled]),"+"textarea:not([disabled]),"+"select:not([disabled]),"+"input:not([disabled]),"+"iframe,"+"details > summary,"+"[role=button],"+"[role=link],"+"[role=menuitem],"+"[role=option],"+"[role=tab],"+"[role=treeitem],"+"[role=checkbox],"+"[role=radio],"+"[aria-checked],"+"[contenteditable=true],"+"[contenteditable=plaintext-only],"+"[tabindex],"+"[onclick]"));var iframes=doc.querySelectorAll("iframe");iframes.forEach((function(iframe){try{var iframeDoc=iframe.contentDocument||iframe.contentWindow.document;var iframeElements=_getAllCandidateElements(openKeyNav,iframeDoc);allElements=allElements.concat(Array.from(iframeElements))}catch(error){console.log("Access denied to iframe content:",error)}}));var mergedSet=new Set([].concat(_toConsumableArray(allElements),_toConsumableArray(openKeyNav.config.modesConfig.click.clickEventElements)));return Array.from(mergedSet)};var lifecycle={};Object.defineProperty(lifecycle,"__esModule",{value:true});lifecycle.enable=lifecycle.disable=void 0;lifecycle.enable=function enable(){};lifecycle.disable=function disable(){};Object.defineProperty(keypress,"__esModule",{value:true});keypress.modiferKeyString=keypress.handleKeyPress=void 0;var _clicking=clicking;var _dragAndDrop=dragAndDrop;var _escape$1=_escape$3;var _focus=focus;var _isTabbable=isTabbable;var _keylabels=keylabels;var _keyButton$2=keyButton;function getMetaKeyName(){var userAgent=window.navigator.userAgent.toLowerCase();if(userAgent.indexOf("mac")>=0)return"Cmd";if(userAgent.indexOf("win")>=0)return"Win";if(userAgent.indexOf("linux")>=0)return"Super";return"Meta"}var modiferKeyString=keypress.modiferKeyString=function modiferKeyString(openKeyNav){switch(openKeyNav.config.keys.modifierKey){case"shiftKey":return"Shift";case"altKey":return"Alt";case"metaKey":return getMetaKeyName();default:return openKeyNav.config.keys.modifierKey}};keypress.handleKeyPress=function handleKeyPress(openKeyNav,e){var isTextInputActive=openKeyNav.isTextInputActive();if(e[openKeyNav.config.keys.modifierKey]&&openKeyNav.config.keys.menu.toLowerCase()==e.key.toLowerCase()){if(isTextInputActive){if(!e[openKeyNav.config.keys.inputEscape]){return true}}if(!openKeyNav.meta.enabled.value){openKeyNav.enable();var message="openKeyNav enabled. Press ".concat((0,_keyButton$2.keyButton)([modiferKeyString(openKeyNav),openKeyNav.config.keys.menu])," to disable.");openKeyNav.emitNotification(message);return true}else{(0,_escape$1.handleEscape)(openKeyNav,e);openKeyNav.disable();var _message="openKeyNav disabled. Press ".concat((0,_keyButton$2.keyButton)([modiferKeyString(openKeyNav),openKeyNav.config.keys.menu])," to enable.");openKeyNav.emitNotification(_message);return true}}switch(e.key){case"Shift":case"Control":case"Alt":case"Meta":case" ":return true;case"Escape":(0,_escape$1.handleEscape)(openKeyNav,e);break}if(openKeyNav.config.modes.clicking.value){return handleClickMode(openKeyNav,e)}if(openKeyNav.config.modes.moving.value){return handleMoveMode(openKeyNav,e)}if(openKeyNav.config.modes.menu.value){handleMenuMode()}if(isTextInputActive){if(!e[openKeyNav.config.keys.inputEscape]){return true}}if(!openKeyNav.meta.enabled.value){return true}switch(e.key){case openKeyNav.config.keys.escape:(0,_escape$1.handleEscape)(openKeyNav,e);return true}switch(e.key){case openKeyNav.config.keys.click:case openKeyNav.config.keys.click.toUpperCase():e.preventDefault();openKeyNav.config.modes.clicking.value=true;if(e.key==openKeyNav.config.keys.click.toUpperCase()){openKeyNav.config.modesConfig.click.modifier=true}(0,_keylabels.showClickableOverlays)(openKeyNav);return true;case openKeyNav.config.keys.move:case openKeyNav.config.keys.move.toUpperCase():e.preventDefault();openKeyNav.config.modes.moving.value=true;if(e.key==openKeyNav.config.keys.move.toUpperCase()){openKeyNav.config.modesConfig.move.modifier=true}(0,_keylabels.showMoveableFromOverlays)(openKeyNav);return true;case openKeyNav.config.keys.menu:case openKeyNav.config.keys.menu.toUpperCase():openKeyNav.config.modes.menu.value=true;if(e.key==openKeyNav.config.keys.menu.toUpperCase()){openKeyNav.config.modesConfig.menu.modifier=true}return true}switch(e.key.toLowerCase()){case openKeyNav.config.keys.heading.toLowerCase():e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h1, h2, h3, h4, h5, h6",e);return true;case openKeyNav.config.keys.scroll.toLowerCase():e.preventDefault();(0,_focus.focusOnScrollables)(openKeyNav,e);return true}var numberMap={Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0"};if(e.code){var numberPressed=numberMap[e.code];switch(numberPressed){case openKeyNav.config.keys.heading_1:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h1",e);break;case openKeyNav.config.keys.heading_2:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h2",e);break;case openKeyNav.config.keys.heading_3:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h3",e);break;case openKeyNav.config.keys.heading_4:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h4",e);break;case openKeyNav.config.keys.heading_5:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h5",e);break;case openKeyNav.config.keys.heading_6:e.preventDefault();(0,_focus.focusOnHeadings)(openKeyNav,"h6",e);break}}};var handleClickMode=function handleClickMode(openKeyNav,e){e.preventDefault();openKeyNav.config.typedLabel.value+=e.key.toLowerCase();var target=document.querySelector('[data-openkeynav-label="'.concat(openKeyNav.config.typedLabel.value,'"]'));if(!target){document.querySelectorAll("iframe").forEach((function(iframe){addKeydownEventListenerToIframe(openKeyNav,iframe)}))}if(target){setTimeout((function(){(0,_clicking.handleTargetClickInteraction)(openKeyNav,target,e)}),0)}else{(0,_keylabels.filterRemainingOverlays)(openKeyNav,e);return false}return true};var handleMoveMode=function handleMoveMode(openKeyNav,e){var showMoveableToOverlays=function showMoveableToOverlays(selectedMoveable){var modifer=openKeyNav.config.modesConfig.move.modifier;openKeyNav.removeOverlays();openKeyNav.config.modes.moving.value=true;openKeyNav.config.modesConfig.move.selectedMoveable=selectedMoveable;openKeyNav.config.modesConfig.move.selectedMoveableHTML=selectedMoveable.innerHTML;openKeyNav.config.modesConfig.move.modifier=modifer;var configIndex=selectedMoveable.getAttribute("data-openkeynav-moveconfig");if(configIndex===null)return;var configKeyForSelectedMoveable=parseInt(configIndex,10);openKeyNav.config.modesConfig.move.selectedConfig=configKeyForSelectedMoveable;var moveConfig=openKeyNav.config.modesConfig.move.config[configKeyForSelectedMoveable];if(!moveConfig)return;function tabbableFilter(openKeyNav){return function(el){return(0,_isTabbable.isTabbable)(el,openKeyNav)}}var targetElements=[].filter.call(document.querySelectorAll(moveConfig.toElements),tabbableFilter(openKeyNav));var labels=(0,_keylabels.generateLabels)(openKeyNav,targetElements.length);targetElements.forEach((function(element,index){element.setAttribute("data-openkeynav-label",labels[index])}));targetElements.forEach((function(element,index){if(!openKeyNav.isNonzeroSize(element))return;openKeyNav.createOverlay(element,labels[index]);element.setAttribute("data-openkeynav-dropzone","true")}))};function findElementWithQuery(startElement,queryString){var direction=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"next";var currentElement=startElement;while(currentElement){if(direction==="previous"){currentElement=currentElement.previousElementSibling;while(!currentElement&&startElement.parentElement){currentElement=startElement.parentElement.previousElementSibling;startElement=startElement.parentElement}if(currentElement){var descendants=currentElement.querySelectorAll(queryString);if(descendants.length>0){return descendants[descendants.length-1]}if(currentElement.matches(queryString)){return currentElement}}}else if(direction==="next"){currentElement=currentElement.nextElementSibling;while(!currentElement&&startElement.parentElement){currentElement=startElement.parentElement.nextElementSibling;startElement=startElement.parentElement}if(currentElement){if(currentElement.matches(queryString)){return currentElement}var foundElement=currentElement.querySelector(queryString);if(foundElement){return foundElement}}}else{throw new Error("Invalid direction. Use 'previous' or 'next'.")}}return null}function cycleThroughMoveTargets(event){event.preventDefault();var direction="next";if(event.shiftKey){direction="previous"}return findElementWithQuery(openKeyNav.config.modesConfig.move.selectedMoveable,"[data-openkeynav-label]:not(.openKeyNav-label)",direction)}var validLabelChars=(0,_keylabels.generateValidKeyChars)(openKeyNav);var isValidLabelChar=Array.from(validLabelChars).some((function(validChar){return validChar.toLowerCase()==e.key.toLowerCase()}));var selectedTarget;if(isValidLabelChar){openKeyNav.config.typedLabel.value+=e.key.toLowerCase();selectedTarget=document.querySelector('[data-openkeynav-label="'.concat(openKeyNav.config.typedLabel.value,'"]:not(.openKeyNav-label)'))}else{if(e.key==="Tab"){selectedTarget=cycleThroughMoveTargets(e)}}if(!selectedTarget){(0,_keylabels.filterRemainingOverlays)(openKeyNav,e);return false}if(!openKeyNav.config.modesConfig.move.selectedMoveable){console.log("Selected element to move:",selectedTarget);showMoveableToOverlays(selectedTarget);(0,_dragAndDrop.beginDrag)(openKeyNav);return true}moveSelectedMoveableToTarget(openKeyNav,selectedTarget);return true};var handleMenuMode=function handleMenuMode(e){return true};var moveSelectedMoveableToTarget=function moveSelectedMoveableToTarget(openKeyNav,selectedTarget){console.log("Selected move target:",selectedTarget);openKeyNav.config.modesConfig.move.selectedDropZone=selectedTarget;var callback=openKeyNav.config.modesConfig.move.config[openKeyNav.config.modesConfig.move.selectedConfig].callback;if(!callback){(0,_dragAndDrop.simulateDragAndDrop)(openKeyNav,openKeyNav.config.modesConfig.move.selectedMoveable,openKeyNav.config.modesConfig.move.selectedDropZone)}else{openKeyNav.config.modesConfig.move.config[openKeyNav.config.modesConfig.move.selectedConfig].callback(openKeyNav.config.modesConfig.move.selectedMoveable,openKeyNav.config.modesConfig.move.selectedDropZone)}if(!openKeyNav.config.modesConfig.move.modifier){openKeyNav.removeOverlays(true);openKeyNav.clearMoveAttributes()}return true};var addKeydownEventListenerToIframe=function addKeydownEventListenerToIframe(openKeyNav,iframe){try{var iframeDoc=iframe.contentDocument||iframe.contentWindow.document;var potentialTarget=iframeDoc.querySelector('[data-openkeynav-label="'.concat(openKeyNav.config.typedLabel.value,'"]'));if(potentialTarget){if(!iframeDoc.keypressListenerAdded){var script=iframeDoc.createElement("script");script.textContent=""+"document.addEventListener('keydown', function(event) {"+"window.parent.postMessage({"+"type: 'keydown',"+"key: event.key,"+"keyCode: event.keyCode,"+"altKey: event.altKey,"+"ctrlKey: event.ctrlKey,"+"shiftKey: event.shiftKey,"+"metaKey: event.metaKey"+"}, '*');"+"});"+"document.keypressListenerAdded = true;";iframeDoc.body.appendChild(script)}}}catch(error){console.log("Error accessing iframe content",error)}};var styles={};Object.defineProperty(styles,"__esModule",{value:true});styles.injectToolbarStyleSheet=styles.injectStylesheet=styles.deleteStylesheets=void 0;var openKeyNav$1;var styleClassname="openKeyNav-style";var toolbarStyleClassname="okn-toolbar-stylesheet";var keyButtonStyles="\n  .keyButtonContainer {\n      margin: 0 .1em;\n      display: inline-grid;\n      grid-template-columns: min-content auto;\n      align-items: baseline;\n      column-gap: 4px;\n  }\n  .keyButtonContainer .keyButtonLabel{\n    white-space:nowrap;\n  }\n  .keyButton {\n    display: inline-block;\n    padding: 1px 4px;\n    min-width: 1.3em;\n    text-align: center;\n    line-height: 1;\n    color: hsl(210, 8%, 5%);\n    text-shadow: 0 1px 0 hsl(0, 0%, 100%);\n    background-color: hsl(210, 8%, 90%);\n    border: 1px solid hsl(210, 8%, 68%);\n    border-radius: 3px;\n    box-shadow: 0 1px 1px hsla(210, 8%, 5%, 0.15), inset 0 1px 0 0 hsl(0, 0%, 100%);\n    white-space: nowrap;\n    margin: 0 1px;\n  }\n";styles.injectStylesheet=function injectStylesheet(parent,replace){openKeyNav$1=parent;if(document.querySelectorAll("."+styleClassname).length>0){if(!replace){return}deleteStylesheets()}var style=document.createElement("style");style.className=styleClassname;style.type="text/css";style.textContent=".openKeyNav-label {\n        font: inherit;\n        vertical-align: baseline;\n        box-sizing: border-box;\n        white-space: nowrap;\n        border: 1px solid ".concat(openKeyNav$1.config.spot.fontColor,"; \n        // box-shadow: inset 0 -2.5px 0 ").concat(openKeyNav$1.config.spot.insetColor,", inset 0 -3px 0 #999, 0 0 4px #fff; \n        // background: linear-gradient(to top, #999 5%, ").concat(openKeyNav$1.config.spot.backgroundColor," 20%); \n        background-color: ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        // border-radius: calc( 4px );\n        color: ").concat(openKeyNav$1.config.spot.fontColor,"; \n        display: inline-block;\n        font-size: ").concat(openKeyNav$1.config.spot.fontSize,"; \n        // outline : 2px solid ").concat(openKeyNav$1.config.focus.outlineColor,'; \n        outline-offset: -2px !important;\n        // +"font-weight: bold;"\n        font-weight: inherit;\n        // line-height: 1.5;\n        line-height: 1;\n        margin: 0 .1em 0 1px;\n        overflow-wrap: break-word;\n        // padding: .0 .15em .1em;\n        padding: 3px;\n        text-shadow: 0 1px 0 ').concat(openKeyNav$1.config.spot.insetColor,'; \n        min-width: 1rem;\n        text-align: center;\n        position: absolute;\n        z-index: 99999999;\n        font-family: monospace;\n      }\n      .openKeyNav-label[data-openkeynav-position="left"]::after,\n      .openKeyNav-label[data-openkeynav-position="right"]::before,\n      .openKeyNav-label[data-openkeynav-position="top"]::after,\n      .openKeyNav-label[data-openkeynav-position="bottom"]::before,\n      .openKeyNav-label[data-openkeynav-position="left"]::before,\n      .openKeyNav-label[data-openkeynav-position="right"]::after,\n      .openKeyNav-label[data-openkeynav-position="top"]::before,\n      .openKeyNav-label[data-openkeynav-position="bottom"]::after {\n        content: "";\n        position: absolute;\n      }\n      .openKeyNav-label[data-openkeynav-position="left"]::after,\n      .openKeyNav-label[data-openkeynav-position="right"]::before,\n      .openKeyNav-label[data-openkeynav-position="left"]::before,\n      .openKeyNav-label[data-openkeynav-position="right"]::after {\n        top: 50%;\n        transform: translateY(-50%);\n      }\n      .openKeyNav-label[data-openkeynav-position="top"]::after,\n      .openKeyNav-label[data-openkeynav-position="bottom"]::before,\n      .openKeyNav-label[data-openkeynav-position="top"]::before,\n      .openKeyNav-label[data-openkeynav-position="bottom"]::after {\n        left: 50%;\n        transform: translateX(-50%);\n      }\n      .openKeyNav-label[data-openkeynav-position="left"]::before {\n        border-left: ').concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid #fff; \n        right: -").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px; \n        border-top: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid transparent; \n        border-bottom: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="left"]::after {\n        border-left: ').concat(openKeyNav$1.config.spot.arrowSize_px,"px solid ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        right: -").concat(openKeyNav$1.config.spot.arrowSize_px,"px; \n        border-top: ").concat(openKeyNav$1.config.spot.arrowSize_px,"px solid transparent; \n        border-bottom: ").concat(openKeyNav$1.config.spot.arrowSize_px,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="right"]::before {\n        border-right: ').concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid #fff; \n        left: -").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px; \n        border-top: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid transparent; \n        border-bottom: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="right"]::after {\n        border-right: ').concat(openKeyNav$1.config.spot.arrowSize_px,"px solid ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        left: -").concat(openKeyNav$1.config.spot.arrowSize_px,"px; \n        border-top: ").concat(openKeyNav$1.config.spot.arrowSize_px,"px solid transparent; \n        border-bottom: ").concat(openKeyNav$1.config.spot.arrowSize_px,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="top"]{\n        padding-bottom: 0;\n      }\n      .openKeyNav-label[data-openkeynav-position="top"]::before {\n        border-top: ').concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid #fff; \n        bottom: -").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px; \n        border-left: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid transparent; \n        border-right: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="top"]::after {\n        border-top: ').concat(openKeyNav$1.config.spot.arrowSize_px,"px solid ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        bottom: -").concat(openKeyNav$1.config.spot.arrowSize_px,"px; \n        border-left: ").concat(openKeyNav$1.config.spot.arrowSize_px,"px solid transparent; \n        border-right: ").concat(openKeyNav$1.config.spot.arrowSize_px,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="bottom"]{\n        padding-top: 0;\n      }\n      .openKeyNav-label[data-openkeynav-position="bottom"]::before {\n        border-bottom: ').concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid #fff; \n        top: -").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px; \n        border-left: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,"px solid transparent; \n        border-right: ").concat(openKeyNav$1.config.spot.arrowSize_px+1,'px solid transparent; \n      }\n      .openKeyNav-label[data-openkeynav-position="bottom"]::after {\n        border-bottom: ').concat(openKeyNav$1.config.spot.arrowSize_px,"px solid ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        top: -").concat(openKeyNav$1.config.spot.arrowSize_px,"px; \n        border-left: ").concat(openKeyNav$1.config.spot.arrowSize_px,"px solid transparent; \n        border-right: ").concat(openKeyNav$1.config.spot.arrowSize_px,"px solid transparent; \n      }\n      .openKeyNav-label-selected{\n        // padding : 0;\n        // margin : 0;\n        display : grid;\n        align-content : center;\n        color : ").concat(openKeyNav$1.config.spot.fontColor,"; \n        background : ").concat(openKeyNav$1.config.spot.backgroundColor,"; \n        // outline : 4px solid ").concat(openKeyNav$1.config.focus.outlineColor,"; \n        outline: none; \n        // border-radius: 100%; \n        // width: 1rem; \n        // height: 1rem; \n        // text-shadow : none;\n        // padding : 0 !important;\n        // margin: 0 !important;\n      }\n      [data-openkeynav-label]:not(.openKeyNav-label):not(button){\n        // outline: 2px double ").concat(openKeyNav$1.config.focus.outlineColor,' !important; \n        // outline-offset: 2px !important;\n        box-shadow:  inset 0 0 0 .5px #000,\n                      0 0 0 .75px #000,\n                      0 0 0 1.5px rgba(255,255,255,1); \n        outline:none !important;\n        // border-radius: 3px;\n        border-color: #000;\n        border-radius: 3px;\n      }\n      button[data-openkeynav-label]{\n        outline:2px solid #000 !important;\n      }\n      .openKeyNav-inaccessible:not(.openKeyNav-label):not(button){\n        box-shadow:  inset 0 0 0 .5px #f00,\n                      0 0 0 1px #f00,\n                      0 0 0 1.5px rgba(255,255,255,1); \n        outline:none !important;\n        border-color: #f00;\n        border-radius: 3px;\n      }\n      button.openKeyNav-inaccessible{\n        outline:2px solid #f00 !important;\n      }\n      .openKeyNav-inaccessible.openKeyNav-label{\n        box-shadow:  inset 0 0 0 .5px #f00,\n                      0 0 0 1px #f00,\n                      0 0 0 1.5px rgba(255,255,255,1); \n        border-color: #f00;\n        border-radius: 3px;\n      }\n        //   +"span[data-openkeynav-label]{"\n        //       +"display: inherit;"\n        //   +"}"\n      .openKeyNav-noCursor *{\n        cursor: none !important;\n      }\n      .openKeyNav-mouseover-tooltip{\n        position: absolute;\n        background-color: #333;\n        color: #fff;\n        padding: 5px;\n        border-radius: 5px;\n        display: none;\n        z-index: 1000;\n        font-size: 12px;\n      }\n      .openKeyNav-mouseover-tooltip::before{\n        content: "Debug mode"\n      }\n      //   [data-openkeynav-draggable="true"] {\n      //   outline: 2px solid ').concat(openKeyNav$1.config.focus.outlineColor,"; \n      //   outline-offset: -1px !important;\n      // }\n      ;\n      ");style.textContent+='\n      .okn-logo-text {\n          font-size: 36px;\n          font-weight: 600;\n          color: #ffffff;\n          background-color: #333;\n          padding: .1em .2em;\n          border-radius: 1em;\n          box-sizing: border-box;\n          line-height: 1;\n          text-align: center;\n          position: relative;\n          display: inline-block;\n          min-width: 1rem;\n          border: max(.1em, 2px) solid #ffffff;\n          white-space: nowrap;\n      }\n\n      .okn-logo-text.small {\n          font-size: 18px;\n      }\n      .okn-logo-text.tiny {\n          font-size: 10px;\n          /* border-width: 1px; */\n          border: none;\n      }\n      .okn-logo-text.tiny .key {\n          font-weight: 700;\n      }\n\n      .okn-logo-text.light {\n          color: #333; /* Dark text color */\n          background-color: #fff; /* Light background */\n          border-color: #333; /* Dark border */\n      }\n\n      .okn-logo-text .key {\n          display: inline;\n          padding: .1em .2em;\n          margin: 0 .1em;\n          background-color: #ffffff; /* Light background */\n          color: #333; /* Dark text */\n          line-height: 1;\n          /* font-size: 0.6em; */\n          position: relative;\n          top: -.3em;\n      }\n\n      .okn-logo-text.light .key {\n          background-color: #333; /* Dark background */\n          color: #ffffff; /* Light text */\n      }\n\n      .okn-logo-text .key::before,\n      .okn-logo-text .key::after {\n          content: "";\n          position: absolute;\n          left: 50%;\n          transform: translateX(-50%);\n      }\n\n      .okn-logo-text .key::before {\n          --border-size: 0.5em; /* Base border size */\n          --min-border-size: 5px; /* Minimum pixel size */\n\n          border-top: max(var(--border-size), var(--min-border-size)) solid #333;\n          bottom: calc(-1 * max(var(--border-size), var(--min-border-size)));\n          border-left: max(var(--border-size), var(--min-border-size)) solid transparent;\n          border-right: max(var(--border-size), var(--min-border-size)) solid transparent;\n      }\n      .okn-logo-text.light .key::before {\n          border-top-color: #fff; /* Dark top triangle */\n      }\n\n      .okn-logo-text .key::after {\n          --border-size: .4em; /* Base border size */\n          --min-border-size: 4px; /* Minimum pixel size */\n\n          border-top: max( calc( var(--border-size) + 2px) , var(--min-border-size)) solid #fff;\n          bottom: calc(-1 * max(var(--border-size), var(--min-border-size)));\n          border-left: max(var(--border-size), var(--min-border-size)) solid transparent;\n          border-right: max(var(--border-size), var(--min-border-size)) solid transparent;\n      }\n\n      .okn-logo-text.light .key::after {\n          border-top-color: #333; /* Light bottom triangle */\n      }\n      ';style.textContent+=keyButtonStyles;style.textContent+="\n        [data-openkeynav-label]:not(.openKeyNav-label){\n          opacity:1 !important;\n          visibility:visible !important;\n        }\n      ";style.textContent+="\n        [data-openkeynav-focused]{\n          outline: 2px ".concat(openKeyNav$1.config.focus.outlineStyle," ").concat(openKeyNav$1.config.focus.outlineColor," !important; \n          outline-offset: -2px !important;\n        }\n      ");document.head.appendChild(style)};var deleteStylesheets=styles.deleteStylesheets=function deleteStylesheets(){document.querySelectorAll("."+styleClassname).forEach((function(el){el.parentNode&&el.parentNode.removeChild(el)}))};styles.injectToolbarStyleSheet=function injectToolbarStyleSheet(parent){openKeyNav$1=parent;if(!!document.querySelector(toolbarStyleClassname)){return false}var style=document.createElement("style");style.setAttribute("class",toolbarStyleClassname);var toolBarHeight=openKeyNav$1.config.toolBar.height;var toolBarVerticalPadding=6;var toolbarBackground="\n      background-color: ".concat(openKeyNav$1.config.toolBar.backgroundColor.value,";\n      color: ").concat(openKeyNav$1.config.toolBar.contentColor.value,";\n      border: 1px solid hsl(210, 8%, 68%);\n      border-radius: 4px;\n      padding: 3px ").concat(toolBarVerticalPadding,"px;\n  ");style.type="text/css";style.textContent="\n  .openKeyNav-toolBar {\n      // width: 200px;    // needs to have a set width (or a min-width) since the content changes inside... \n                          // min-widh is set inside the init depending on number of keys\n      // max-width: 200px;\n      // background-color: #333;\n      color: #333;\n      // z-index: 10000;\n      ".concat(toolbarBackground,"\n      font-size:12px;\n      display: flex;\n      align-items: center;\n      // align-items: end;\n      flex-direction: column;\n      // direction: rtl;\n      max-height: ").concat(toolBarHeight,"px;\n      position:relative;\n  }\n  .openKeyNav-toolBar > p{\n      overflow: hidden;\n  }\n  .openKeyNav-toolBar p{\n      font-size: 16px;\n      margin-bottom: 0;\n      line-height: ").concat(toolBarHeight-toolBarVerticalPadding,"px;\n      text-align: left;\n  }\n  .openKeyNav-toolBar-expanded {\n      position: absolute;\n      top: 0;\n      margin-top: 40px;\n      width: 100%;\n      ").concat(toolbarBackground,"\n      display: grid;\n      justify-content: left;\n  }\n  // .openKeyNav-toolBar span.stacked {\n  //     display: inline-grid;\n  //     grid-template-rows: auto auto;\n  // }\n  ");style.textContent+=keyButtonStyles;document.head.appendChild(style)};Object.defineProperty(toolbar,"__esModule",{value:true});toolbar.handleToolBar=void 0;var _signals$1=signals;var _keyButton$1=keyButton;var _keypress$1=keypress;var _styles$1=styles;function _createForOfIteratorHelper$1(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray$1(r))||e){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _unsupportedIterableToArray$1(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray$1(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray$1(r,a):void 0}}function _arrayLikeToArray$1(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var openKeyNav;toolbar.handleToolBar=function handleToolBar(openKeyNav_obj){openKeyNav=openKeyNav_obj;function initToolbarLogic(toolBarElement){if(toolBarElement.dataset.initialized==="true")return;toolBarElement.dataset.initialized="true";(0,_styles$1.injectToolbarStyleSheet)(openKeyNav);var lastMessage;(0,_signals$1.effect)((function(){openKeyNav.config.modes;openKeyNav.config.typedLabel.value;updateToolbar(toolBarElement,lastMessage)}));(0,_signals$1.effect)((function(){var backgroundColor=openKeyNav.config.toolBar.backgroundColor.value;var contentColor=openKeyNav.config.toolBar.contentColor.value;updateToolbarColors({backgroundColor:backgroundColor,contentColor:contentColor})}))}var toolBarElements=document.querySelectorAll(".openKeyNav-toolBar");toolBarElements.forEach((function(toolBarElement){if(toolBarElement){initToolbarLogic(toolBarElement)}}));var observer=new MutationObserver((function(mutationsList,observerInstance){var _iterator=_createForOfIteratorHelper$1(mutationsList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var mutation=_step.value;for(var _i=0,_Array$from=Array.from(mutation.addedNodes);_i<_Array$from.length;_i++){var node=_Array$from[_i];if(node.nodeType===1&&node.matches&&node.matches(".openKeyNav-toolBar")){initToolbarLogic(node);return}if(node.nodeType===1){var _node$querySelectorAl;var descendants=(_node$querySelectorAl=node.querySelectorAll)===null||_node$querySelectorAl===void 0?void 0:_node$querySelectorAl.call(node,".openKeyNav-toolBar");descendants.forEach((function(descendant){if(descendant){initToolbarLogic(descendant);return}}))}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}));observer.observe(document.body,{childList:true,subtree:true})};var toolbarTemplates={default:function _default(){var toolBarElement=document.querySelector(".openKeyNav-toolBar");if(!toolBarElement){return}toolBarElement.style.minWidth="150px";var clickButton="";var dragButton="";var menuButton=(0,_keyButton$1.keyButton)([(0,_keypress$1.modiferKeyString)(openKeyNav),openKeyNav.config.keys.menu],"openKeyNav");if(openKeyNav.meta.enabled.value){menuButton=(0,_keyButton$1.keyButton)([openKeyNav.config.keys.menu],"Shortcuts")}return"<p>\n                    ".concat(menuButton,"\n                    ").concat(dragButton,"\n                    ").concat(clickButton," \n                </p>\n            ")},clickMode:function clickMode(){return"<p>".concat((0,_keyButton$1.keyButton)(["Esc"],"Click Mode"),"</p>")},dragMode:function dragMode(){return"<p>".concat((0,_keyButton$1.keyButton)(["Esc"],"Drag Mode"),"</p>")},menu:function menu(){var dragButton="";if(openKeyNav.config.modesConfig.move.config.length){dragButton=(0,_keyButton$1.keyButton)([openKeyNav.config.keys.move],"Drag")}return"\n            <p>".concat((0,_keyButton$1.keyButton)(["Esc"],"Shortcuts"),'</p>\n            <div class="openKeyNav-toolBar-expanded">\n                ').concat((0,_keyButton$1.keyButton)([openKeyNav.config.keys.click],"Click"),"\n                ").concat(dragButton,"\n            </div>\n        ")}};var updateElement=function updateElement(element,html){element.innerHTML=html};var updateToolbar=function updateToolbar(toolBarElement,lastMessage){if(!toolBarElement){return}var message;var typedLabel=openKeyNav.config.typedLabel.value;if(openKeyNav.config.modes.clicking.value){message=toolbarTemplates.clickMode(typedLabel)}else if(openKeyNav.config.modes.moving.value){message=toolbarTemplates.dragMode(typedLabel)}else if(openKeyNav.config.modes.menu.value){message=toolbarTemplates.menu(typedLabel)}else{message=toolbarTemplates.default()}if(message===lastMessage){return}updateElement(toolBarElement,message);lastMessage=message};var updateToolbarColors=function updateToolbarColors(_ref){var backgroundColor=_ref.backgroundColor,contentColor=_ref.contentColor;var toolbar=document.querySelector(".openKeyNav-toolBar");if(!toolbar){return false}if(backgroundColor){toolbar.style.backgroundColor=backgroundColor}if(contentColor){toolbar.style.color=contentColor}};Object.defineProperty(OpenKeyNav$1,"__esModule",{value:true});exports.default=OpenKeyNav$1.default=void 0;var _version=version;var _signals=signals;var _toolbar=toolbar;var _keyButton=keyButton;var _styles=styles;var _keypress=keypress;var _escape=_escape$3;function _createForOfIteratorHelper(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e){t&&(r=t);var _n=0,F=function F(){};return{s:F,n:function n(){return _n>=r.length?{done:!0}:{done:!1,value:r[_n++]}},e:function e(r){throw r},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function s(){t=t.call(r)},n:function n(){var r=t.next();return a=r.done,r},e:function e(r){u=!0,o=r},f:function f(){try{a||null==t.return||t.return()}finally{if(u)throw o}}}}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _callSuper(t,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e))}function _possibleConstructorReturn(t,e){if(e&&("object"==_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function _wrapNativeSuper(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,Wrapper)}function Wrapper(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t)},_wrapNativeSuper(t)}function _construct(t,e,r){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t.bind.apply(t,o));return r&&_setPrototypeOf(p,r.prototype),p}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!t})()}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(n){return"function"==typeof t}}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _classCallCheck(a,n){if(!(a instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:i+""}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var OpenKeyNav=function(){function OpenKeyNav(){var _this=this;_classCallCheck(this,OpenKeyNav);this.config={spot:{fontColor:"white",backgroundColor:"#333",insetColor:"#000",fontSize:"inherit",arrowSize_px:4},focus:{outlineColor:"#0088cc",outlineStyle:"solid"},toolBar:{height:32,backgroundColor:(0,_signals.signal)("hsl(210 10% 95% / 1)"),contentColor:(0,_signals.signal)("#000")},notifications:{enabled:true,displayToolName:true,duration:3e3},keys:{escape:"q",click:"k",scroll:"s",move:"m",heading:"h",textBlock:"n",landmarkRegion:"d",formField:"f",mouseOver:"v",heading_1:"1",heading_2:"2",heading_3:"3",heading_4:"4",heading_5:"5",heading_6:"6",menu:"o",inputEscape:"ctrlKey",modifierKey:"shiftKey"},modesConfig:{move:{config:[],selectedConfig:false,selectedMoveable:false,selectedMoveableHTML:false,selectedDropZone:false,modifier:false},click:{modifier:false,clickEventElements:new Set,eventListenersMap:new Map},menu:{modifier:false}},log:[],typedLabel:(0,_signals.signal)(""),headings:{currentHeadingIndex:0,list:[]},scrollables:{currentScrollableIndex:0,list:[]},modes:{clicking:(0,_signals.signal)(false),moving:(0,_signals.signal)(false),menu:(0,_signals.signal)(false)},debug:{screenReaderVisible:false,keyboardAccessible:true},enabledCookie:"openKeyNav_enabled"};this.meta={enabled:(0,_signals.signal)(false)};this.enable=function(){_this.meta.enabled.value=true;_this.injectStyles();_this.getSetCookie(_this.config.enabledCookie,true);return _this};this.disable=function(){_this.meta.enabled.value=false;_this.getSetCookie(_this.config.enabledCookie,false);_this.removeStyles();return _this}}return _createClass(OpenKeyNav,[{key:"setupTouchEvent",value:function setupTouchEvent(){window.TouchEvent=function(_Event){function TouchEvent(type,initDict){var _this2;_classCallCheck(this,TouchEvent);_this2=_callSuper(this,TouchEvent,[type,initDict]);_this2.touches=initDict.touches||[];_this2.targetTouches=initDict.targetTouches||[];_this2.changedTouches=initDict.changedTouches||[];_this2.altKey=initDict.altKey||false;_this2.metaKey=initDict.metaKey||false;_this2.ctrlKey=initDict.ctrlKey||false;_this2.shiftKey=initDict.shiftKey||false;return _this2}_inherits(TouchEvent,_Event);return _createClass(TouchEvent)}(_wrapNativeSuper(Event));window.Touch=_createClass((function _class(_ref){var identifier=_ref.identifier,target=_ref.target,clientX=_ref.clientX,clientY=_ref.clientY;_classCallCheck(this,_class);this.identifier=identifier;this.target=target;this.clientX=clientX;this.clientY=clientY;this.screenX=clientX;this.screenY=clientY;this.pageX=clientX;this.pageY=clientY}))}},{key:"deepMerge",value:function deepMerge(target,source){var _this3=this;Object.keys(source).forEach((function(key){if(source[key]&&_typeof(source[key])==="object"){if(!target[key]||_typeof(target[key])!=="object"){target[key]={}}_this3.deepMerge(target[key],source[key])}else{target[key]=source[key]}}));return target}},{key:"injectStyles",value:function injectStyles(replace){(0,_styles.injectStylesheet)(this,replace)}},{key:"removeStyles",value:function removeStyles(){(0,_styles.deleteStylesheets)()}},{key:"initToolBar",value:function initToolBar(){(0,_toolbar.handleToolBar)(this)}},{key:"isNonzeroSize",value:function isNonzeroSize(element){var rect=element.getBoundingClientRect();return rect.width>0&&rect.height>0}},{key:"isTextInputActive",value:function isTextInputActive(){var tagName=document.activeElement.tagName.toLowerCase();var editable=document.activeElement.getAttribute("contenteditable");var inputTypes=["input","textarea"];var isEditable=editable==="true"||editable==="plaintext-only"||editable==="";return inputTypes.includes(tagName)||isEditable}},{key:"updateOverlayPosition",value:function updateOverlayPosition(element,overlay){var elementsToAvoid=document.querySelectorAll("[data-openkeynav-label], .openKeyNav-label-selected, .openKeyNav-toolBar");var rectAvoid=element.getBoundingClientRect();var overlayWidth=overlay.getBoundingClientRect().width;var overlayHeight=overlay.getBoundingClientRect().height;var arrowWidth=this.config.spot.arrowSize_px;function isBoundingBoxIntersecting(rectOverlay,rectAvoid){return!(rectOverlay.right<=rectAvoid.left||rectOverlay.left>=rectAvoid.right||rectOverlay.bottom<=rectAvoid.top||rectOverlay.top>=rectAvoid.bottom)}var isOverlapping=function isOverlapping(overlay,avoidEl){var rectOverlay=overlay.getBoundingClientRect();var rectAvoid=avoidEl.getBoundingClientRect();var isOverlapping_OnTop=function isOverlapping_OnTop(){var padding=0;var corners=[{x:rectOverlay.left-padding,y:rectOverlay.top-padding},{x:rectOverlay.right+padding,y:rectOverlay.top-padding},{x:rectOverlay.left-padding,y:rectOverlay.bottom+padding},{x:rectOverlay.right+padding,y:rectOverlay.bottom+padding}];overlay.style.visibility="hidden";var isOverlapping=corners.some((function(corner){if(corner.x>=0&&corner.x<=window.innerWidth&&corner.y>=0&&corner.y<=window.innerHeight){var elementAtPoint=document.elementFromPoint(corner.x,corner.y);return avoidEl===elementAtPoint||avoidEl.contains(elementAtPoint)||elementAtPoint&&(elementAtPoint.contains(element)||elementAtPoint.classList.contains("openKeyNav-ignore-overlap"))}return false}));overlay.style.visibility="visible";return isOverlapping};return isBoundingBoxIntersecting(rectOverlay,rectAvoid)&&isOverlapping_OnTop()};function isCutOff(el){var rect=el.getBoundingClientRect();return rect.left<0||rect.right>window.innerWidth||rect.top<0||rect.bottom>window.innerHeight}function checkOverlap(overlay){return isCutOff(overlay)||Array.from(elementsToAvoid).some((function(avoidEl){if(avoidEl===overlay||avoidEl===element){return false}var rectElement=element.getBoundingClientRect();var rectAvoidEl=avoidEl.getBoundingClientRect();var isElementOnTop=isBoundingBoxIntersecting(rectElement,rectAvoidEl);if(isElementOnTop){return false}return isOverlapping(overlay,avoidEl)}))}overlay.removeAttribute("data-openkeynav-position");overlay.style.position="absolute";overlay.style.left="".concat(rectAvoid.left-(overlayWidth+arrowWidth)+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top+window.scrollY,"px");var position="left";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.right+arrowWidth-2+window.scrollX,"px");position="right";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top-(overlayHeight+arrowWidth)+window.scrollY,"px");position="top";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.bottom+arrowWidth+window.scrollY,"px");position="bottom";if(!checkOverlap(overlay)){overlay.setAttribute("data-openkeynav-position",position);return}overlay.removeAttribute("data-openkeynav-position");overlay.style.left="".concat(rectAvoid.left+window.scrollX,"px");overlay.style.top="".concat(rectAvoid.top+window.scrollY,"px")}},{key:"updateOverlayPosition_bak",value:function updateOverlayPosition_bak(element,overlay){var rect=element.getBoundingClientRect();var adjustedLeft=rect.left;var adjustedTop=rect.top;var parent=element.ownerDocument.defaultView.frameElement;while(parent){var parentRect=parent.getBoundingClientRect();adjustedLeft+=parentRect.left;adjustedTop+=parentRect.top;parent=parent.ownerDocument.defaultView.frameElement}overlay.style.left="".concat(adjustedLeft+window.scrollX,"px");overlay.style.top="".concat(adjustedTop+window.scrollY,"px")}},{key:"createOverlay",value:function createOverlay(element,label){var _this4=this;function getScrollParent(element){var includeHidden=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var style=getComputedStyle(element);var excludeStaticParent=style.position==="absolute";var overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/;if(style.position==="fixed")return document.body;for(var parent=element;parent=parent.parentElement;){style=getComputedStyle(parent);if(excludeStaticParent&&style.position==="static"){continue}if(overflowRegex.test(style.overflow+style.overflowY+style.overflowX))return parent}return document.body}var overlay=document.createElement("div");overlay.textContent=label;overlay.classList.add("openKeyNav-label");overlay.setAttribute("data-openkeynav-label",label);overlay.addEventListener("click",(function(){try{inspect(element)}catch(error){console.log(element)}}));document.body.appendChild(overlay);this.updateOverlayPosition(element,overlay);var scrollParent=getScrollParent(element);if(scrollParent){scrollParent.addEventListener("scroll",(function(){return _this4.updateOverlayPosition(element,overlay)}))}if(element.classList.contains("openKeyNav-inaccessible")){overlay.classList.add("openKeyNav-inaccessible")}return overlay}},{key:"isAnyCornerVisible",value:function isAnyCornerVisible(element){var isElementInIframe=function isElementInIframe(element){return element.ownerDocument!==window.document};var doc=element.ownerDocument;var win=doc.defaultView||doc.parentWindow;var rect=element.getBoundingClientRect();var corners=[{x:rect.left+1,y:rect.top+1},{x:rect.right-1,y:rect.top+1},{x:rect.left+1,y:rect.bottom-1},{x:rect.right-1,y:rect.bottom-1}];if(isElementInIframe(element)){var frameElement=win.frameElement;if(frameElement){var frameRect=frameElement.getBoundingClientRect();corners.forEach((function(corner){corner.x+=frameRect.left;corner.y+=frameRect.top}));doc=frameElement.ownerDocument;win=doc.defaultView||doc.parentWindow}}for(var _i=0,_corners=corners;_i<_corners.length;_i++){var corner=_corners[_i];var elemAtPoint=doc.elementFromPoint(corner.x,corner.y);if(elemAtPoint===element||element.contains(elemAtPoint)||elemAtPoint&&(elemAtPoint.contains(element)||elemAtPoint.classList.contains("openKeyNav-ignore-overlap"))){return true}}return false}},{key:"getScrollableElements",value:function getScrollableElements(){var _this5=this;var getComputedStyle=document.body&&document.body.currentStyle?function(elem){return elem.currentStyle}:function(elem){return document.defaultView.getComputedStyle(elem,null)};function getActualCss(elem,style){return getComputedStyle(elem)[style]}function isXScrollable(elem){var overflowX=getActualCss(elem,"overflow-x");if(overflowX==="scroll")return true;return elem.offsetWidth<elem.scrollWidth&&(overflowX==="scroll"||overflowX==="auto"||overflowX==="overlay")}function isYScrollable(elem){var overflowY=getActualCss(elem,"overflow-y");if(overflowY==="scroll")return true;return elem.offsetHeight<elem.scrollHeight&&(overflowY==="scroll"||overflowY==="auto"||overflowY==="overlay")}function isPotentiallyScrollable(elem){var position=getActualCss(elem,"position");var display=getActualCss(elem,"display");var visibility=getActualCss(elem,"visibility");if(position==="static"&&display==="inline"&&visibility!=="hidden"){return false}return true}var hasScroller=function hasScroller(elem){if(!_this5.config.debug.screenReaderVisible){return _this5.isAnyCornerVisible(elem)&&isPotentiallyScrollable(elem)&&(isYScrollable(elem)||isXScrollable(elem))}return isPotentiallyScrollable(elem)&&(isYScrollable(elem)||isXScrollable(elem))};return[].filter.call(document.querySelectorAll("*"),hasScroller)}},{key:"preventScroll",value:function preventScroll(e){e.preventDefault();e.stopPropagation();return false}},{key:"clearMoveAttributes",value:function clearMoveAttributes(){document.querySelectorAll("[data-openkeynav-moveconfig]").forEach((function(el){el.removeAttribute("data-openkeynav-moveconfig");el.removeAttribute("data-openkeynav-draggable")}))}},{key:"removeOverlays",value:function removeOverlays(removeAll){var _this6=this;var resetModes=function resetModes(){for(var key in _this6.config.modes){_this6.config.modes[key].value=false}_this6.config.modesConfig.move.selectedConfig=false;_this6.config.modesConfig.move.selectedMoveable=false;_this6.config.modesConfig.move.selectedMoveableHTML=false;_this6.config.modesConfig.move.selectedDropZone=false;_this6.config.modesConfig.move.modifier=false;_this6.config.modesConfig.click.modifier=false;_this6.config.modesConfig.menu.modifier=false};var clearInaccessibleWarnings=function clearInaccessibleWarnings(){document.querySelectorAll(".openKeyNav-inaccessible").forEach((function(el){el.classList.remove("openKeyNav-inaccessible");if(_this6.config.modesConfig.click.eventListenersMap.has(el)){var _this6$config$modesCo=_this6.config.modesConfig.click.eventListenersMap.get(el),showTooltip=_this6$config$modesCo.showTooltip,hideTooltip=_this6$config$modesCo.hideTooltip;el.removeEventListener("mouseover",showTooltip);el.removeEventListener("mouseleave",hideTooltip);_this6.config.modesConfig.click.eventListenersMap.delete(el)}}));document.querySelectorAll(".openKeyNav-mouseover-tooltip").forEach((function(el){return el.remove()}))};var enableScrolling=function enableScrolling(){var enableScrollingForEl=function enableScrollingForEl(el){el.removeEventListener("scroll",_this6.preventScroll,{passive:false});el.removeEventListener("wheel",_this6.preventScroll,{passive:false});el.removeEventListener("touchmove",_this6.preventScroll,{passive:false})};var enableScrollingForScrollableElements=function enableScrollingForScrollableElements(){enableScrollingForEl(window);_this6.getScrollableElements().forEach((function(el){enableScrollingForEl(el)}))};enableScrollingForScrollableElements()};var removeAllOverlays=function removeAllOverlays(){document.querySelectorAll(".openKeyNav-label").forEach((function(el){return el.remove()}))};var removeAllOverlaysExceptThis=function removeAllOverlaysExceptThis(selectedLabel,typedLabel){selectedLabel.innerHTML="&bull;";selectedLabel.classList.add("openKeyNav-label-selected");document.querySelectorAll('.openKeyNav-label:not([data-openkeynav-label="'.concat(typedLabel,'"])')).forEach((function(el){return el.remove()}))};if(this.config.modes.clicking.value){enableScrolling()}clearInaccessibleWarnings();if(removeAll){removeAllOverlays()}else{if(!this.config.modes.moving.value){removeAllOverlays()}else{var selectedLabel=document.querySelector('.openKeyNav-label[data-openkeynav-label="'.concat(this.config.typedLabel.value,'"]'));if(!selectedLabel){removeAllOverlays()}else{this.config.modesConfig.move.selectedLabel=selectedLabel;removeAllOverlaysExceptThis(selectedLabel,this.config.typedLabel.value)}}}document.querySelectorAll("[data-openkeynav-label]").forEach((function(el){el.removeAttribute("data-openkeynav-label")}));resetModes();this.config.typedLabel.value=""}},{key:"flagAsInaccessible",value:function flagAsInaccessible(el,reason,modality){switch(modality){case"keyboard":if(!this.config.debug.keyboardAccessible){return false}}var openKeyNav=this;function createTooltip(el,innerHTML){var tooltip=document.createElement("div");tooltip.className="openKeyNav-mouseover-tooltip";tooltip.innerHTML=innerHTML;tooltip.style.display="none";document.body.appendChild(tooltip);function showTooltip(){var rect=el.getBoundingClientRect();tooltip.style.left="".concat(rect.left+window.scrollX,"px");tooltip.style.top="".concat(rect.bottom+window.scrollY-2,"px");tooltip.style.display="block"}function hideTooltip(){var mouseX=event.clientX;var mouseY=event.clientY;var tooltipRect=tooltip.getBoundingClientRect();var isMouseOverTooltip=mouseX>=tooltipRect.left&&mouseX<=tooltipRect.right&&mouseY>=tooltipRect.top&&mouseY<=tooltipRect.bottom;if(!isMouseOverTooltip){tooltip.style.display="none"}}el.addEventListener("mouseover",showTooltip);el.addEventListener("mouseleave",hideTooltip);tooltip.addEventListener("mouseleave",hideTooltip);openKeyNav.config.modesConfig.click.eventListenersMap.set(el,{showTooltip:showTooltip,hideTooltip:hideTooltip})}createTooltip(el,reason);el.classList.add("openKeyNav-inaccessible");el.setAttribute("data-openkeynav-inaccessible-reason",reason);return true}},{key:"addKeydownEventListener",value:function addKeydownEventListener(){var _this7=this;document.addEventListener("keydown",(function(e){(0,_keypress.handleKeyPress)(_this7,e)}),true);window.addEventListener("message",(function(e){if(e.data.type==="keydown"){console.log("Key pressed in iframe:",e.data.key);var newEvent=new KeyboardEvent("keydown",{key:e.data.key,keyCode:e.data.keyCode,altKey:e.data.altKey,ctrlKey:e.data.ctrlKey,shiftKey:e.data.shiftKey,metaKey:e.data.metaKey,bubbles:true,cancelable:true});if(newEvent.key==="Escape"){(0,_escape.handleEscape)(_this7,e)}document.dispatchEvent(newEvent)}}))}},{key:"emitNotification",value:function emitNotification(message){var getSetNotificationContainer=function getSetNotificationContainer(){var notificationContainer=document.getElementById("okn-notification-container");if(!notificationContainer){notificationContainer=document.createElement("div");notificationContainer.id="okn-notification-container";notificationContainer.className="openKeyNav-ignore-overlap";notificationContainer.style.position="fixed";notificationContainer.style.bottom="10px";notificationContainer.style.left="50%";notificationContainer.style.transform="translateX(-50%)";notificationContainer.style.display="flex";notificationContainer.style.flexDirection="column";notificationContainer.style.alignItems="center";notificationContainer.style.gap="10px";notificationContainer.style.zIndex="1000";document.body.appendChild(notificationContainer)}return notificationContainer};if(!this.config.notifications.enabled){return}var notificationContainer=getSetNotificationContainer();while(notificationContainer.firstChild){notificationContainer.firstChild.remove()}var notification=document.createElement("div");notification.style.backgroundColor="rgba(0, 0, 0, 0.8)";notification.style.color="#fff";notification.style.padding="10px 20px";notification.style.borderRadius="5px";notification.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)";notification.style.maxWidth="400px";notification.style.textAlign="center";notification.style.position="relative";notification.style.display="inline-block";notification.setAttribute("role","alert");notification.setAttribute("aria-live","assertive");notification.setAttribute("aria-atomic","true");if(this.config.notifications.displayToolName){var logo=document.createElement("div");logo.className="okn-logo-text tiny";logo.setAttribute("role","img");logo.setAttribute("aria-label","OpenKeyNav");logo.innerHTML='Open<span class="key">Key</span>Nav';notification.appendChild(logo)}var messageDiv=document.createElement("div");messageDiv.innerHTML=message;notification.appendChild(messageDiv);notificationContainer.appendChild(notification);setTimeout((function(){notification.remove()}),this.config.notifications.duration)}},{key:"initStatusBar",value:function initStatusBar(){var _this8=this;var lastMessage="No mode active.";(0,_signals.effect)((function(){var modes=_this8.config.modes;var message;if(modes.clicking.value){message="In Click Mode. Press ".concat((0,_keyButton.keyButton)(["Esc"])," to exit.")}else if(modes.moving.value){message="In Drag Mode. Press ".concat((0,_keyButton.keyButton)(["Esc"])," to exit.")}else{message="No mode active."}if(message===lastMessage){return}_this8.emitNotification(message);lastMessage=message}));(0,_signals.effect)((function(){var modes=_this8.config.modes;var statusBar=document.getElementById("status-bar");if(!statusBar){console.warn("Status bar element not found in the DOM.");return}if(modes.clicking.value){statusBar.textContent="In click mode. Press Esc to exit."}else if(modes.moving.value){statusBar.textContent="In drag mode. Press Esc to exit."}else{statusBar.textContent="No mode active."}}))}},{key:"checkEnabled",value:function checkEnabled(){if(this.getSetCookie(this.config.enabledCookie)){this.enable()}}},{key:"getSetCookie",value:function getSetCookie(cookieName,value){function setCookie(cookieName,v){var expires=new Date(Date.now()+365*24*60*60*1e3).toUTCString();document.cookie="".concat(cookieName,"=").concat(v,"; expires=").concat(expires,"; path=/; domain=").concat(location.hostname)}function getCookie(cookieName){var match=document.cookie.match(new RegExp("(^|; )"+cookieName+"=([^;]*)"));if(match){return match[2]==="true"}return null}if(typeof value!=="undefined"){setCookie(cookieName,value===true||value==="true"?"true":"false");return}return getCookie(cookieName)}},{key:"applicationSupport",value:function applicationSupport(){if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="::1"){return}try{fetch("https://applicationsupport.openkeynav.com/capture/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({properties:{version:_version.version},event:"openKeyNav.js version ping"})})}catch(error){}}},{key:"setupGlobalClickListenerTracking",value:function setupGlobalClickListenerTracking(){var clickEventElements=this.config.modesConfig.click.clickEventElements;var originalAddEventListener=EventTarget.prototype.addEventListener;var originalRemoveEventListener=EventTarget.prototype.removeEventListener;EventTarget.prototype.addEventListener=function(type,listener,options){if(type==="click"){var isEmptyFunction=listener&&/^\s*function\s*\(\)\s*\{\s*\}\s*$/.test(listener.toString());if(!isEmptyFunction){clickEventElements.add(this)}}return originalAddEventListener.call(this,type,listener,options)};EventTarget.prototype.removeEventListener=function(type,listener,options){if(type==="click"){var remainingListeners=getEventListeners(this,"click").filter((function(l){return l.listener!==listener}));if(remainingListeners.length===0){clickEventElements.delete(this)}}return originalRemoveEventListener.call(this,type,listener,options)};var observer=new MutationObserver((function(mutationsList){var _iterator=_createForOfIteratorHelper(mutationsList),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var mutation=_step.value;if(mutation.removedNodes.length>0){mutation.removedNodes.forEach((function(node){if(node.nodeType===Node.ELEMENT_NODE){removeDescendantsFromSet(node)}}))}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}));observer.observe(document.body,{childList:true,subtree:true});function removeDescendantsFromSet(element){if(clickEventElements.has(element)){clickEventElements.delete(element)}element.querySelectorAll("*").forEach((function(child){if(clickEventElements.has(child)){clickEventElements.delete(child)}}))}function getEventListeners(el,eventType){var listeners=[];var eventKey="__eventListener__".concat(eventType);if(el[eventKey]){listeners.push({listener:el[eventKey]})}return listeners}}},{key:"init",value:function init(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};this.deepMerge(this.config,options);this.addKeydownEventListener();this.initStatusBar();this.initToolBar();this.applicationSupport();this.checkEnabled();console.log("Library initialized with config:",this.config);return this}}])}();exports.default=OpenKeyNav$1.default=OpenKeyNav;return exports.default}));